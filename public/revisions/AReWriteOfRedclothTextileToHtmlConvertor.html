<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>A re-write of Redcloth textile to html convertor</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<style type="text/css" media="screen">
		@import url( ../Static/style.css );
	</style>
	<link rel='alternate' type='application/rss+xml' title='RSS' href='http://tom.counsell.org/rss/AReWriteOfRedclothTextileToHtmlConvertor' />
	<script src='http://tom.counsell.org/Static/newpage.js' type='text/javascript'></script>
		
</head>

<body onkeypress='hotkey(event,"http://tom.counsell.org/edit/");'>
<div id="wrapper">
	<div id="masthead">
		<div id="blogtitle" >
			A re-write of Redcloth textile to html convertor
		</div>
	</div>
	
	<div id="insideWrapper">
	
		<div id="sidebar">
			<div id="sidebox">
				<div class="title"><a href="../index.html" title="Tom Counsell's Soks Wiki">Tom Counsell's Soks Wiki</a></div>
			</div>
			<br />
	
			<div id="sidebox1">
				<div class="title">Key Pages</div>
				
				<a href='../index.html' class='automatic'>Home Page</a> <br/>
<a href='../view/SiteIndex.html' class='automatic'>Site Index</a> <br/>
<a href='../view/RecentChangesToThisSite.html' class=''>Recent Changes</a> <br/>
			</div>
			<br />

			<div id="sidebox4">
				<form style="padding: 0px; margin-top: 0px; margin-bottom: 0px;" id="searchform" method="get" action="http://tom.counsell.org/find/AReWriteOfRedclothTextileToHtmlConvertor">
					<div class="title">Search:</div>
					<p style="padding: 0px; margin-top: 0px; margin-bottom: 0px;">
						<input type="text" class="input" name="regex" id="search" size="15" />
						<input name="submit" type="submit" tabindex="5" value="GO" />
					</p>
				</form>
			</div>
			<br />
			
			<div id='adbox'>
				<div class='title'>Adverts</div>
				<script type="text/javascript"><!--
				google_ad_client = "pub-1825629230893907";
				google_ad_width = 120;
				google_ad_height = 90;
				google_ad_format = "120x90_0ads_al";
				google_ad_channel = "";
				google_color_border = "000000";
				google_color_bg = "000000";
				google_color_link = "FFFFFF";
				google_color_text = "CCCCCC";
				google_color_url = "999999";
				//-->
				</script>
				<script type="text/javascript"
				  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
				  </script>
<p>
</p>
			</div>
<br/>			
			<div id="sidebox2">
				<div class="title">Backlinks</div>
				
					
					
					
				
			</div>
			<br />
	
			<div id="sidebox3">
				<div class="title">Other Pages</div>
				<a href='../view/History.html' class='automatic'>History</a> <br/>
<a href='../view/Phd.html' class='automatic'>PhD</a> <br/>
<a href='../view/StuffIDoAroundTheDepartment.html' class=''>Department work</a> <br/>
<a href='../view/CollegeWork.html' class='automatic'>College work</a> <br/>
<a href='../view/Programming.html' class='automatic'>Programming</a> <br/>
			</div>
			<br />
			

	
			<div id="sidebox5">
				<div class="title">Links</div>
				<a href='http://tom.counsell.org/edit/TypeATitleHere'>Add a new page</a><br/>
				<a href='http://tom.counsell.org/edit/PictureOfTypeATitleHere'>Upload a new picture</a><br/>
				<a href='http://tom.counsell.org/edit/AttachedTypeATitleHere'>Upload a new file</a><br/>
			</div>
			<br />
	
			<div id="sidebox6">
				<div class="title"><a href='http://www.soks.org'>Soks</a> Powered</div>
				<a href='http://www.soks.org'>Soks</a> is a wiki written in ruby
			</div>  
			<br />
	</div>
	
	<div id="contentwrapper">
		<div id="content">
			<br />
			<div class="post">
			<span class='pagename'><a href='http://tom.counsell.org/meta/AReWriteOfRedclothTextileToHtmlConvertor'>A re-write of Redcloth textile to html convertor</a> (Deleted)</span>






	<div class="undochange">
		<p>Tue Aug 09 04:43:12 -0400 2005 by <a href='../view/Tamc.html'>tamc</a></p>
		<ol>	
		
				
						<li><del>0. h1. Textile to HTML</del></li>
					
				
						<li><del>1. </del></li>
					
				
						<li>0. content moved to [[Textile to HTML]]</li>
					
				
						<li><del>2. Textile is a markup language that is meant to make it quick and easy to write basic web pages for wikis, blogs and other uses.  Redcloth is a ruby class that converts textile to html, written by _why.  Details are at http://www.whytheluckystiff.net/ruby/redcloth/ .  Unfortunately, due to my own failings, I find it hard to understand _why's code, so I wrote a partial reimplementation bellow.  This has the benefit of (for me) being clearer and easier to extend.  The drawback is that it doesn't do all that _why's version does and is slower.  But it is here in case anyone finds it useful.</del></li>
					
				
						<li><del>3. </del></li>
					
				
						<li><del>4. &lt;pre&gt;</del></li>
					
				
						<li><del>5. &lt;code&gt;</del></li>
					
				
						<li><del>6. require 'strscan'</del></li>
					
				
						<li><del>7. </del></li>
					
				
						<li><del>8. # Note: Does not implement anything beyond that on http://hobix.com/textile/</del></li>
					
				
						<li><del>9. # i.e. No markdown, link titles, and converting out of range ASCII</del></li>
					
				
						<li><del>10. # AND IT IS MUCH SLOWER THAN REDCLOTH !!</del></li>
					
				
						<li><del>11. #</del></li>
					
				
						<li><del>12. # Bodged together in a few evenings by Tom Counsell (tamc2@cam.ac.uk)</del></li>
					
				
						<li><del>13. # Feel free to do whatever you like with the code.</del></li>
					
				
						<li><del>14. #</del></li>
					
				
						<li><del>15. # Use is the same as for Redcloth (except that none of the options work):</del></li>
					
				
						<li><del>16. # html = TextileParser.new( "textile string").to_html </del></li>
					
				
						<li><del>17. #</del></li>
					
				
						<li><del>18. class TextileParser</del></li>
					
				
						<li><del>19. 	</del></li>
					
				
						<li><del>20. 	# These are applied first</del></li>
					
				
						<li><del>21. 	BLOCK_COMMANDS = [</del></li>
					
				
						<li><del>22. 		[ /&lt;pre.*?&gt;/, :pre_tag ], </del></li>
					
				
						<li><del>23. 		[ /&lt;code.*?&gt;/, :code_tag ],</del></li>
					
				
						<li><del>24. 		[ /&lt;notextile.*?&gt;/, :notextile_tag ],</del></li>
					
				
						<li><del>25. 		[ /h(\d)(.*?)\.\s+/i, :heading_block ],</del></li>
					
				
						<li><del>26. 		[ /bq(.*?)\.\s+/i, :quote_block ],</del></li>
					
				
						<li><del>27. 		[ /(\*+|\#+)\s+/,  :list_block ],</del></li>
					
				
						<li><del>28. 		[ /table(.*?)\.\s+/i, :table_block ],</del></li>
					
				
						<li><del>29. 		[ /\|/i, :unspecified_table_block ],</del></li>
					
				
						<li><del>30. 		[ /\{.+?\}\.\s+\|/i, :unspecified_table_block ], # A styled table row		</del></li>
					
				
						<li><del>31. 		[ /p(.*?)\.\s+/i, :paragraph_block ],</del></li>
					
				
						<li><del>32. 		[ /fn(\d+)(.*?)\.\s+/i, :footnote_block ],</del></li>
					
				
						<li><del>33. 		[ /\S+/i, :unspecified_block ],</del></li>
					
				
						<li><del>34. 		[ /\s+/i, :skip ],</del></li>
					
				
						<li><del>35. 	]</del></li>
					
				
						<li><del>36. 	</del></li>
					
				
						<li><del>37. 	# Then these</del></li>
					
				
						<li><del>38. 	COMMANDS = [</del></li>
					
				
						<li><del>39. 		[ /&lt;pre.*?&gt;/, :pre_tag ], # Can be inline as well as in a block</del></li>
					
				
						<li><del>40. 		[ /&lt;code.*?&gt;/, :code_tag ],  # Can be inline as well as in a block</del></li>
					
				
						<li><del>41. 		[ /&lt;notextile.*?&gt;/, :notextile_tag ],  # Can be inline as well as in a block</del></li>
					
				
						<li><del>42. 		[ /@(\S.*?\S)@/, :quick_escape_code ], </del></li>
					
				
						<li><del>43. 		[ /"(.+?)":(\S*\w\/?)/, :textile_link ],</del></li>
					
				
						<li><del>44. 		[ /\[(.+?)\]:(\S*\w\/?)/, :textile_link_alias ],</del></li>
					
				
						<li><del>45. 		[ /!(.+?)!(\S*)/, :image_link ],</del></li>
					
				
						<li><del>46. 		[ /([A-Z0-9]+)\((.*?)\)/, :acronym ],</del></li>
					
				
						<li><del>47. 		[ /(\S+?)\[(\d+)\]/, :footnote ]</del></li>
					
				
						<li><del>48. 	]	</del></li>
					
				
						<li><del>49. 	</del></li>
					
				
						<li><del>50. 	# Bit of a bodge, but need a different definition of phrase and whitespace in a table</del></li>
					
				
						<li><del>51. 	INLINE_COMMANDS = COMMANDS + [</del></li>
					
				
						<li><del>52. 		[ /\S+/i, :phrase ],</del></li>
					
				
						<li><del>53. 		[ /\s+/i, :space ],</del></li>
					
				
						<li><del>54. 	]</del></li>
					
				
						<li><del>55. 	</del></li>
					
				
						<li><del>56. 	TABLE_INLINE_COMMANDS = COMMANDS + [</del></li>
					
				
						<li><del>57. 		[ /[^\s\t\r\n\f\|]+/i, :phrase ],</del></li>
					
				
						<li><del>58. 		[ /\s+/i, :space ],</del></li>
					
				
						<li><del>59. 	]		</del></li>
					
				
						<li><del>60. 	</del></li>
					
				
						<li><del>61. 	# Then these are applied to phrases from above</del></li>
					
				
						<li><del>62. 	PHRASE_MODIFIERS = [ </del></li>
					
				
						<li><del>63. 		[ '__', 'i' ],</del></li>
					
				
						<li><del>64. 		[ '**', 'b' ],</del></li>
					
				
						<li><del>65. 		[ '_', 'em' ],</del></li>
					
				
						<li><del>66. 		[ '*', 'strong' ],</del></li>
					
				
						<li><del>67. 		[ '??', 'cite' ],</del></li>
					
				
						<li><del>68. 		[ '-', 'del' ],</del></li>
					
				
						<li><del>69. 		[ '+', 'ins' ],</del></li>
					
				
						<li><del>70. 		[ '^', 'sup' ],</del></li>
					
				
						<li><del>71. 		[ '~', 'sub' ],</del></li>
					
				
						<li><del>72. 		[ '%', 'span' ], # How to avoid when people use % as in 3.0% growth?</del></li>
					
				
						<li><del>73. 		].collect! { |regexp,tag| [ /^#{Regexp.escape(regexp)}/, /#{Regexp.escape(regexp)}$/, tag ] }</del></li>
					
				
						<li><del>74. 			</del></li>
					
				
						<li><del>75. 	# Character substitutions done last to any words</del></li>
					
				
						<li><del>76. 	GLYPHS = [</del></li>
					
				
						<li><del>77. 		[ /^\'/, '&#8216;' ], # single opening</del></li>
					
				
						<li><del>78. 		[ /^"/, '&#8220;' ], # double opening</del></li>
					
				
						<li><del>79. 		[ /\'$/, '&#8217;' ], # single closing</del></li>
					
				
						<li><del>80.        	[ /\"$/, '&#8221;' ], # double closing</del></li>
					
				
						<li><del>81.         [ /\.{3}$/, '\1&#8230;' ], # ellipsis</del></li>
					
				
						<li><del>82.         [ '--', '\1&#8212;' ], # em dash</del></li>
					
				
						<li><del>83.         [ '-&gt;', ' &rarr; ' ], # right arrow</del></li>
					
				
						<li><del>84.         [ '-$', ' &#8211; ' ], # en dash</del></li>
					
				
						<li><del>85. </del></li>
					
				
						<li><del>86.         [ '(TM)', '&#8482;' ], # trademark</del></li>
					
				
						<li><del>87.         [ '(R)', '&#174;' ], # registered</del></li>
					
				
						<li><del>88.         [ '(C)', '&#169;' ] # copyright</del></li>
					
				
						<li><del>89.     ]</del></li>
					
				
						<li><del>90.     </del></li>
					
				
						<li><del>91. 	# This is just used to give the ouput html a more beautiful layout</del></li>
					
				
						<li><del>92. 	# All tags in here will get a newline after they are output</del></li>
					
				
						<li><del>93. 	# and the indent for following lines increased by the number</del></li>
					
				
						<li><del>94. 	INDENTING_TAGS = { 	'ul' =&gt; 1,</del></li>
					
				
						<li><del>95. 						'ol' =&gt; 1,</del></li>
					
				
						<li><del>96. 						'li' =&gt; 0,</del></li>
					
				
						<li><del>97. 						'blockquote' =&gt; 1,</del></li>
					
				
						<li><del>98. 						'table' =&gt; 1,</del></li>
					
				
						<li><del>99. 						'tr' =&gt; 1,</del></li>
					
				
						<li><del>100. 						'td' =&gt; 0,</del></li>
					
				
						<li><del>101. 						'th' =&gt; 0,</del></li>
					
				
						<li><del>102. 						'p' =&gt; 0,</del></li>
					
				
						<li><del>103. 					 }</del></li>
					
				
						<li><del>104. 	</del></li>
					
				
						<li><del>105. 	def initialize( text )</del></li>
					
				
						<li><del>106. 		@text = text</del></li>
					
				
						<li><del>107. 	end</del></li>
					
				
						<li><del>108. </del></li>
					
				
						<li><del>109. 	def to_html( settings = nil )</del></li>
					
				
						<li><del>110. 		reset</del></li>
					
				
						<li><del>111. 		convert_text</del></li>
					
				
						<li><del>112. 		return html.chomp.chomp # the tests don't have any trailing \ns</del></li>
					
				
						<li><del>113. 	end</del></li>
					
				
						<li><del>114. 	</del></li>
					
				
						<li><del>115. 	private</del></li>
					
				
						<li><del>116. 	</del></li>
					
				
						<li><del>117. 	## Methods dealing with blocks of text are called first</del></li>
					
				
						<li><del>118. 	</del></li>
					
				
						<li><del>119. 	def convert_text</del></li>
					
				
						<li><del>120. 		until @scanner.eos?</del></li>
					
				
						<li><del>121. 			send( BLOCK_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</del></li>
					
				
						<li><del>122. 			add_to_html "\n" # Prettier html if extra space between blocks </del></li>
					
				
						<li><del>123. 		end</del></li>
					
				
						<li><del>124. 		insert_any_link_aliases</del></li>
					
				
						<li><del>125. 		html</del></li>
					
				
						<li><del>126. 	end</del></li>
					
				
						<li><del>127. 	</del></li>
					
				
						<li><del>128. 	# These are all the block commands</del></li>
					
				
						<li><del>129. 	</del></li>
					
				
						<li><del>130. 	def paragraph_block</del></li>
					
				
						<li><del>131. 		tag( 'p', parse_attributes( @scanner[1] ) ) do </del></li>
					
				
						<li><del>132. 			standard_paragraph</del></li>
					
				
						<li><del>133. 		end</del></li>
					
				
						<li><del>134. 	end</del></li>
					
				
						<li><del>135. 	</del></li>
					
				
						<li><del>136. 	def quote_block</del></li>
					
				
						<li><del>137. 		tag( "blockquote", parse_attributes( @scanner[1] ) ) do</del></li>
					
				
						<li><del>138. 			tag 'p' do</del></li>
					
				
						<li><del>139. 				standard_paragraph</del></li>
					
				
						<li><del>140. 			end</del></li>
					
				
						<li><del>141. 		end</del></li>
					
				
						<li><del>142. 	end</del></li>
					
				
						<li><del>143. 	</del></li>
					
				
						<li><del>144. 	def unspecified_block</del></li>
					
				
						<li><del>145. 		@scanner.unscan</del></li>
					
				
						<li><del>146. 		tag 'p' do</del></li>
					
				
						<li><del>147. 			standard_paragraph</del></li>
					
				
						<li><del>148. 		end</del></li>
					
				
						<li><del>149. 	end</del></li>
					
				
						<li><del>150. 		</del></li>
					
				
						<li><del>151. 	def heading_block</del></li>
					
				
						<li><del>152. 		tag( "h#{@scanner[1]}", parse_attributes( @scanner[2] ) ) do</del></li>
					
				
						<li><del>153. 			standard_line # Assume titles may only be on one line</del></li>
					
				
						<li><del>154. 		end </del></li>
					
				
						<li><del>155. 	end</del></li>
					
				
						<li><del>156. 	</del></li>
					
				
						<li><del>157. 	def list_block</del></li>
					
				
						<li><del>158. 		ordered = list_ordered? # See what sort of list we have</del></li>
					
				
						<li><del>159. 		depth = list_depth</del></li>
					
				
						<li><del>160. 		@scanner.unscan # So that the lines can be scanned individually</del></li>
					
				
						<li><del>161. 		tag( ordered ? 'ol' : 'ul' ) do</del></li>
					
				
						<li><del>162. 			list_line( ordered, depth ) until end_of_list?( depth )</del></li>
					
				
						<li><del>163. 		end</del></li>
					
				
						<li><del>164. 	end</del></li>
					
				
						<li><del>165. 	</del></li>
					
				
						<li><del>166. 	def table_block</del></li>
					
				
						<li><del>167. 		tag( 'table', parse_attributes( @scanner[1] ) ) do</del></li>
					
				
						<li><del>168. 			table_line until end_of_paragraph?</del></li>
					
				
						<li><del>169. 		end</del></li>
					
				
						<li><del>170. 	end</del></li>
					
				
						<li><del>171. 	</del></li>
					
				
						<li><del>172. 	def unspecified_table_block</del></li>
					
				
						<li><del>173. 		@scanner.unscan</del></li>
					
				
						<li><del>174. 		tag( 'table' ) do</del></li>
					
				
						<li><del>175. 			table_line until end_of_paragraph?</del></li>
					
				
						<li><del>176. 		end</del></li>
					
				
						<li><del>177. 	end</del></li>
					
				
						<li><del>178. 	</del></li>
					
				
						<li><del>179. 	def footnote_block</del></li>
					
				
						<li><del>180. 		number = @scanner[1]</del></li>
					
				
						<li><del>181. 		attributes = parse_attributes( @scanner[2] )</del></li>
					
				
						<li><del>182. 		attributes[:id] = "fn#{number}"</del></li>
					
				
						<li><del>183. 		tag 'p', attributes do</del></li>
					
				
						<li><del>184. 			add_to_html "&lt;sup&gt;#{number}&lt;/sup&gt; "</del></li>
					
				
						<li><del>185. 			standard_line until end_of_paragraph?</del></li>
					
				
						<li><del>186. 		end</del></li>
					
				
						<li><del>187. 	end</del></li>
					
				
						<li><del>188. 	</del></li>
					
				
						<li><del>189. 	# Now descend into methods dealing with lines of text</del></li>
					
				
						<li><del>190. 	</del></li>
					
				
						<li><del>191. 	def pre_tag</del></li>
					
				
						<li><del>192. 		escape_tag 'pre'</del></li>
					
				
						<li><del>193. 	end</del></li>
					
				
						<li><del>194. 	</del></li>
					
				
						<li><del>195. 	def code_tag</del></li>
					
				
						<li><del>196. 		escape_tag 'code'</del></li>
					
				
						<li><del>197. 	end</del></li>
					
				
						<li><del>198. 	</del></li>
					
				
						<li><del>199. 	def notextile_tag</del></li>
					
				
						<li><del>200. 		escape_tag 'notextile', false</del></li>
					
				
						<li><del>201. 	end</del></li>
					
				
						<li><del>202. 	</del></li>
					
				
						<li><del>203. 	# This escapes until a matching close tag</del></li>
					
				
						<li><del>204. 	def escape_tag( tag, include_tag_in_output = true )</del></li>
					
				
						<li><del>205. 		add_to_html( @scanner.matched ) if include_tag_in_output</del></li>
					
				
						<li><del>206. 		level = 1</del></li>
					
				
						<li><del>207. 		while level &gt; 0</del></li>
					
				
						<li><del>208. 			break unless @scanner.scan(/(.*?)(&lt;(\/)?#{tag}.*?&gt;)/m) # Breaks if no closing tag</del></li>
					
				
						<li><del>209. 			add_to_html( htmlesc( @scanner[1] || "" ) )</del></li>
					
				
						<li><del>210. 			level = level + ( @scanner[3] ? -1 : 1 )</del></li>
					
				
						<li><del>211. 			add_to_html( htmlesc( @scanner[2] ) ) unless level == 0</del></li>
					
				
						<li><del>212. 		end</del></li>
					
				
						<li><del>213. 		add_to_html "&lt;/#{tag}&gt;" if include_tag_in_output</del></li>
					
				
						<li><del>214. 	end</del></li>
					
				
						<li><del>215. 	</del></li>
					
				
						<li><del>216. 	def quick_escape_code</del></li>
					
				
						<li><del>217. 		tag 'code' do </del></li>
					
				
						<li><del>218. 			add_to_html( htmlesc( @scanner[1] ) )</del></li>
					
				
						<li><del>219. 		end</del></li>
					
				
						<li><del>220. 	end</del></li>
					
				
						<li><del>221. 	</del></li>
					
				
						<li><del>222. 	def list_line( ordered, depth )</del></li>
					
				
						<li><del>223. 		tag 'li' do</del></li>
					
				
						<li><del>224. 			@scanner.scan(/(#+|\*+)\s+/)</del></li>
					
				
						<li><del>225. 			if ( list_ordered? == ordered ) && ( list_depth == depth )</del></li>
					
				
						<li><del>226. 				standard_line</del></li>
					
				
						<li><del>227. 			else # Recursive for sub lists</del></li>
					
				
						<li><del>228. 				list_block</del></li>
					
				
						<li><del>229. 			end</del></li>
					
				
						<li><del>230. 		end</del></li>
					
				
						<li><del>231. 	end</del></li>
					
				
						<li><del>232. 		</del></li>
					
				
						<li><del>233. 	def table_line</del></li>
					
				
						<li><del>234. 		# Are their row attributes at that start of the line?</del></li>
					
				
						<li><del>235. 		attributes = @scanner.scan(/(\{.+?\})\.\s+/) ? parse_attributes(@scanner[1]) : {} 	</del></li>
					
				
						<li><del>236. 		@scanner.scan(/\|/) # Get rid of any leading cell opening</del></li>
					
				
						<li><del>237. 		tag( 'tr', attributes ) do </del></li>
					
				
						<li><del>238. 			table_cell until end_of_table_line?</del></li>
					
				
						<li><del>239. 		end</del></li>
					
				
						<li><del>240. 	end	</del></li>
					
				
						<li><del>241. 	</del></li>
					
				
						<li><del>242. 	def standard_paragraph</del></li>
					
				
						<li><del>243. 		until end_of_paragraph?	</del></li>
					
				
						<li><del>244. 			send( INLINE_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</del></li>
					
				
						<li><del>245. 		end</del></li>
					
				
						<li><del>246. 	end</del></li>
					
				
						<li><del>247. 	</del></li>
					
				
						<li><del>248. 	def standard_line</del></li>
					
				
						<li><del>249. 		until end_of_line?</del></li>
					
				
						<li><del>250. 			send( INLINE_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</del></li>
					
				
						<li><del>251. 		end</del></li>
					
				
						<li><del>252. 	end</del></li>
					
				
						<li><del>253. 	</del></li>
					
				
						<li><del>254. 	# Now descend into methods dealing with phrases</del></li>
					
				
						<li><del>255. 	</del></li>
					
				
						<li><del>256. 	def table_cell</del></li>
					
				
						<li><del>257. 		# Style defined at start of cell ?</del></li>
					
				
						<li><del>258. 		attributes = @scanner.scan(/(_)?(\S*?)\.\s*/) ?  parse_attributes(@scanner[2]) : {}</del></li>
					
				
						<li><del>259. 		tag( @scanner[1] ? 'th' : 'td', attributes) do </del></li>
					
				
						<li><del>260. 			until end_of_table_cell?</del></li>
					
				
						<li><del>261. 				send( TABLE_INLINE_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</del></li>
					
				
						<li><del>262. 			end	</del></li>
					
				
						<li><del>263. 		end</del></li>
					
				
						<li><del>264. 	end</del></li>
					
				
						<li><del>265. 	</del></li>
					
				
						<li><del>266. 	def footnote</del></li>
					
				
						<li><del>267. 		add_to_html "#{@scanner[1]}&lt;sup&gt;&lt;a href=\"#fn#{@scanner[2]}\"&gt;#{@scanner[2]}&lt;/a&gt;&lt;/sup&gt;"</del></li>
					
				
						<li><del>268. 	end</del></li>
					
				
						<li><del>269. 	</del></li>
					
				
						<li><del>270. 	def acronym</del></li>
					
				
						<li><del>271. 		add_to_html "&lt;acronym title=\"#{@scanner[2]}\"&gt;#{@scanner[1]}&lt;/acronym&gt;"</del></li>
					
				
						<li><del>272. 	end</del></li>
					
				
						<li><del>273. 	</del></li>
					
				
						<li><del>274. 	def phrase</del></li>
					
				
						<li><del>275. 		word = @scanner.matched</del></li>
					
				
						<li><del>276. 		</del></li>
					
				
						<li><del>277. 		return add_to_html( parse_glyphs( word ) ) unless word =~ /\w+/ # If a word is entirely symbols then we will leave it in peace.</del></li>
					
				
						<li><del>278. 		</del></li>
					
				
						<li><del>279. 		# Open tags</del></li>
					
				
						<li><del>280. 		PHRASE_MODIFIERS.each do |start_r, end_r, tag|</del></li>
					
				
						<li><del>281. 			if word =~ start_r</del></li>
					
				
						<li><del>282. 				word = $' # The bit after the match</del></li>
					
				
						<li><del>283. 				# Look for matching brackets that indicate there are attributes</del></li>
					
				
						<li><del>284. 				if word =~ /(\(.+?\)|\{.+?\}|\[.+?\])/ 				</del></li>
					
				
						<li><del>285. 					open_tag( tag, parse_attributes( $1 ) )</del></li>
					
				
						<li><del>286. 					word = $'</del></li>
					
				
						<li><del>287. 				else</del></li>
					
				
						<li><del>288. 					open_tag tag</del></li>
					
				
						<li><del>289. 				end</del></li>
					
				
						<li><del>290. 				break</del></li>
					
				
						<li><del>291. 			end</del></li>
					
				
						<li><del>292. 		end</del></li>
					
				
						<li><del>293. 		</del></li>
					
				
						<li><del>294. 		# Close tags</del></li>
					
				
						<li><del>295. 		end_tag = nil</del></li>
					
				
						<li><del>296. 		PHRASE_MODIFIERS.each do |start_r, end_r, tag|</del></li>
					
				
						<li><del>297. 			if word =~ end_r</del></li>
					
				
						<li><del>298. 				end_tag = tag</del></li>
					
				
						<li><del>299. 				word = $` # The bit before the match</del></li>
					
				
						<li><del>300. 				break</del></li>
					
				
						<li><del>301. 			end</del></li>
					
				
						<li><del>302. 		end</del></li>
					
				
						<li><del>303. 		add_to_html parse_glyphs( word )</del></li>
					
				
						<li><del>304. 		close_tag( end_tag ) if end_tag</del></li>
					
				
						<li><del>305. 	end</del></li>
					
				
						<li><del>306. 	</del></li>
					
				
						<li><del>307. 	def space</del></li>
					
				
						<li><del>308. 		add_to_html @scanner.matched</del></li>
					
				
						<li><del>309. 	end</del></li>
					
				
						<li><del>310. 		</del></li>
					
				
						<li><del>311. 	def image_link</del></li>
					
				
						<li><del>312. 		@scanner.matched =~ /^!([&lt;&gt;]*)(.*?)(!|\((.*?)\)!)($|(:(.+?)$))/</del></li>
					
				
						<li><del>313. 		alignment, src, title, url = $1, $2, $4, $7</del></li>
					
				
						<li><del>314. 		attributes = {}</del></li>
					
				
						<li><del>315. 		attributes[:style] = 'float:right' if alignment == '&gt;'</del></li>
					
				
						<li><del>316. 		attributes[:style] = 'float:left' if alignment == '&lt;'</del></li>
					
				
						<li><del>317. </del></li>
					
				
						<li><del>318. 		attributes[:src] = src</del></li>
					
				
						<li><del>319. 		attributes[:alt] = attributes[ :title ] = title if title</del></li>
					
				
						<li><del>320. 		if url</del></li>
					
				
						<li><del>321. 			tag 'a', { :href =&gt; url } do</del></li>
					
				
						<li><del>322. 				open_tag 'img', attributes, true</del></li>
					
				
						<li><del>323. 			end</del></li>
					
				
						<li><del>324. 		else</del></li>
					
				
						<li><del>325. 			open_tag 'img', attributes, true</del></li>
					
				
						<li><del>326. 		end	</del></li>
					
				
						<li><del>327. 	end</del></li>
					
				
						<li><del>328. 	</del></li>
					
				
						<li><del>329. 	def skip</del></li>
					
				
						<li><del>330. 		# Do nothing !</del></li>
					
				
						<li><del>331. 	end</del></li>
					
				
						<li><del>332. 	</del></li>
					
				
						<li><del>333. 	def textile_link</del></li>
					
				
						<li><del>334. 		add_to_html "&lt;a href=\"#{@scanner[2]}\"&gt;#{@scanner[1]}&lt;/a&gt;"</del></li>
					
				
						<li><del>335. 	end</del></li>
					
				
						<li><del>336. 	</del></li>
					
				
						<li><del>337. 	def textile_link_alias</del></li>
					
				
						<li><del>338. 		# These are saved for later resubstitution</del></li>
					
				
						<li><del>339. 		@aliases[ @scanner[1] ] = @scanner[2]</del></li>
					
				
						<li><del>340. 	end</del></li>
					
				
						<li><del>341. 	</del></li>
					
				
						<li><del>342. 	# These feels clunky, and is done last</del></li>
					
				
						<li><del>343. 	def insert_any_link_aliases</del></li>
					
				
						<li><del>344. 		@aliases.each do |als, href|</del></li>
					
				
						<li><del>345. 			html.gsub!( /href="#{als}"/, "href=\"#{href}\"" )</del></li>
					
				
						<li><del>346. 		end</del></li>
					
				
						<li><del>347. 	end</del></li>
					
				
						<li><del>348. 	</del></li>
					
				
						<li><del>349. 	# These are helper methods that make sure html is properly closed and indented</del></li>
					
				
						<li><del>350. 	</del></li>
					
				
						<li><del>351. 	def tag( tag, attributes = {} )</del></li>
					
				
						<li><del>352. 		open_tag( tag, attributes )</del></li>
					
				
						<li><del>353. 		yield</del></li>
					
				
						<li><del>354. 		close_tag tag</del></li>
					
				
						<li><del>355. 	end</del></li>
					
				
						<li><del>356. 	</del></li>
					
				
						<li><del>357. 	def close_tag( tag = :all_tags )</del></li>
					
				
						<li><del>358. 		# Check the tag has been opened</del></li>
					
				
						<li><del>359. 		return unless open_tags.include?( tag ) || ( tag == :all_tags )</del></li>
					
				
						<li><del>360. 		</del></li>
					
				
						<li><del>361. 		# Close all tags up to that tag (in case one was not closed)</del></li>
					
				
						<li><del>362. 		until open_tags.empty?</del></li>
					
				
						<li><del>363. 			open_tag = open_tags.pop</del></li>
					
				
						<li><del>364. 			# This is just stuff to make the html look pretty</del></li>
					
				
						<li><del>365. 			if (indent = INDENTING_TAGS[ open_tag ] ) </del></li>
					
				
						<li><del>366. 				if indent == 0</del></li>
					
				
						<li><del>367. 					add_to_html "&lt;/#{open_tag}&gt;"</del></li>
					
				
						<li><del>368. 					add_to_html "\n"</del></li>
					
				
						<li><del>369. 				else</del></li>
					
				
						<li><del>370. 					add_to_html "\n" unless html =~ /\n$/</del></li>
					
				
						<li><del>371. 					@indent -= indent</del></li>
					
				
						<li><del>372. 					add_to_html( "\t" * @indent )</del></li>
					
				
						<li><del>373. 					add_to_html "&lt;/#{open_tag}&gt;"</del></li>
					
				
						<li><del>374. 					add_to_html "\n"</del></li>
					
				
						<li><del>375. 				end</del></li>
					
				
						<li><del>376. 			else</del></li>
					
				
						<li><del>377. 				add_to_html "&lt;/#{open_tag}&gt;"</del></li>
					
				
						<li><del>378. 			end</del></li>
					
				
						<li><del>379. 			return if open_tag == tag</del></li>
					
				
						<li><del>380. 		end</del></li>
					
				
						<li><del>381. 	end</del></li>
					
				
						<li><del>382. 	</del></li>
					
				
						<li><del>383. 	def open_tag( tag, attributes = {}, no_close_tag = false )</del></li>
					
				
						<li><del>384. 		add_to_html( "\t" * @indent )</del></li>
					
				
						<li><del>385. 		</del></li>
					
				
						<li><del>386. 		add_to_html "&lt;#{tag}"</del></li>
					
				
						<li><del>387. 		</del></li>
					
				
						<li><del>388. 		attributes.each { |key, value| 	add_to_html( " #{key.to_s}=\"#{value.to_s}\"" )	}</del></li>
					
				
						<li><del>389. 		</del></li>
					
				
						<li><del>390. 		if no_close_tag</del></li>
					
				
						<li><del>391. 			add_to_html " /&gt;"</del></li>
					
				
						<li><del>392. 			return</del></li>
					
				
						<li><del>393. 		end</del></li>
					
				
						<li><del>394. 		</del></li>
					
				
						<li><del>395. 		add_to_html "&gt;"</del></li>
					
				
						<li><del>396. 		</del></li>
					
				
						<li><del>397. 		if (indent = INDENTING_TAGS[ tag ] )			</del></li>
					
				
						<li><del>398. 			add_to_html "\n" unless indent == 0</del></li>
					
				
						<li><del>399. 			@indent += indent</del></li>
					
				
						<li><del>400. 		end</del></li>
					
				
						<li><del>401. 		open_tags &lt;&lt; tag</del></li>
					
				
						<li><del>402. 	end</del></li>
					
				
						<li><del>403. 	</del></li>
					
				
						<li><del>404. 	def open_tags</del></li>
					
				
						<li><del>405. 		@open_tags ||= []</del></li>
					
				
						<li><del>406. 	end</del></li>
					
				
						<li><del>407. 	</del></li>
					
				
						<li><del>408. 	def parse_attributes( attribute_text )</del></li>
					
				
						<li><del>409. 		return {} unless attribute_text && attribute_text != ""</del></li>
					
				
						<li><del>410. 		a = { :style =&gt; "" }</del></li>
					
				
						<li><del>411. 		</del></li>
					
				
						<li><del>412. 		# The hand-entered classes, ids, styles and langs</del></li>
					
				
						<li><del>413. 		# These are replaced with "" so their content cannot be matched below</del></li>
					
				
						<li><del>414. 		a[:lang] = $1 if attribute_text =~ /\[(.+?)\]/</del></li>
					
				
						<li><del>415. 		a[:class] = $1 if attribute_text.sub!(/\((.+?)\)/,'')</del></li>
					
				
						<li><del>416. 		a[:class], a[:id] = $1, $2 if a[:class] =~  /^(.*?)#(.*)$/</del></li>
					
				
						<li><del>417. 		a[:style] &lt;&lt; "#{$1};" if attribute_text.sub!(/\{(.+?)\}/,'')</del></li>
					
				
						<li><del>418. </del></li>
					
				
						<li><del>419. 		# Various padding and indents</del></li>
					
				
						<li><del>420. 		a[:style] &lt;&lt; "padding-left:#{ $1.length }em;" if attribute_text =~ /(\(+)/</del></li>
					
				
						<li><del>421. 		a[:style] &lt;&lt; "padding-right:#{ $1.length }em;" if attribute_text =~ /(\)+)/		</del></li>
					
				
						<li><del>422. </del></li>
					
				
						<li><del>423. 		# The various alignments</del></li>
					
				
						<li><del>424. 		a[:style] &lt;&lt; "text-align:left;" if attribute_text =~ /&lt;(?!&gt;)/</del></li>
					
				
						<li><del>425. 		a[:style] &lt;&lt; "text-align:right;" if attribute_text =~ /(?!&lt;)&gt;/</del></li>
					
				
						<li><del>426. 		a[:style] &lt;&lt; "text-align:justify;" if attribute_text =~ /&lt;&gt;/</del></li>
					
				
						<li><del>427. 		a[:style] &lt;&lt; "text-align:center;" if attribute_text =~ /=/</del></li>
					
				
						<li><del>428. 		</del></li>
					
				
						<li><del>429. 		#Various column spans on tables</del></li>
					
				
						<li><del>430. 		a[:colspan] = $1 if attribute_text =~ /\\(\d+)/</del></li>
					
				
						<li><del>431. 		a[:rowspan] = $1 if attribute_text =~ /\/(\d+)/</del></li>
					
				
						<li><del>432. 		</del></li>
					
				
						<li><del>433. 		#Vertical alignments on tables</del></li>
					
				
						<li><del>434. 		a[:style] &lt;&lt; "vertical-align:top;" if attribute_text =~ /\^/</del></li>
					
				
						<li><del>435. 		a[:style] &lt;&lt; "vertical-align:bottom;" if attribute_text =~ /\~/</del></li>
					
				
						<li><del>436. 		</del></li>
					
				
						<li><del>437. 		# Get rid of any empty attributes before returning</del></li>
					
				
						<li><del>438. 		a.delete_if { |k,v| !v || (v == "") }</del></li>
					
				
						<li><del>439. 	end</del></li>
					
				
						<li><del>440. 	</del></li>
					
				
						<li><del>441. 	def parse_glyphs( word )</del></li>
					
				
						<li><del>442. 		GLYPHS.each do |regexp,replacement|</del></li>
					
				
						<li><del>443. 			word.gsub!( regexp, replacement )</del></li>
					
				
						<li><del>444. 		end</del></li>
					
				
						<li><del>445. 		word</del></li>
					
				
						<li><del>446. 	end</del></li>
					
				
						<li><del>447. 	</del></li>
					
				
						<li><del>448. 	# Now some helper methods for spotting the ends of sections</del></li>
					
				
						<li><del>449. 	</del></li>
					
				
						<li><del>450. 	def end_of_paragraph?</del></li>
					
				
						<li><del>451. 		return true if @scanner.eos?</del></li>
					
				
						<li><del>452. 		@scanner.scan(/\n{2,}/)</del></li>
					
				
						<li><del>453. 	end</del></li>
					
				
						<li><del>454. 	</del></li>
					
				
						<li><del>455. 	def end_of_list?( depth )</del></li>
					
				
						<li><del>456. 		return true if @scanner.eos?</del></li>
					
				
						<li><del>457. 		return true unless @scanner.check(/(#+|\*+)\s+/) # Not a list any more</del></li>
					
				
						<li><del>458. 		return true if list_depth &lt; depth # End of this sub list</del></li>
					
				
						<li><del>459. 		@scanner.scan(/\n{2,}/)</del></li>
					
				
						<li><del>460. 	end</del></li>
					
				
						<li><del>461. 	</del></li>
					
				
						<li><del>462. 	def end_of_line?</del></li>
					
				
						<li><del>463. 		return true if @scanner.eos?</del></li>
					
				
						<li><del>464. 		return true if @scanner.check(/\n{2,}/)</del></li>
					
				
						<li><del>465. 		@scanner.scan(/\n/)</del></li>
					
				
						<li><del>466. 	end</del></li>
					
				
						<li><del>467. 	</del></li>
					
				
						<li><del>468. 	def end_of_table_line?</del></li>
					
				
						<li><del>469. 		return true if @scanner.eos?</del></li>
					
				
						<li><del>470. 		return true if @scanner.check(/\n{2,}/)</del></li>
					
				
						<li><del>471. 		@scanner.scan(/\|\s*\n/)</del></li>
					
				
						<li><del>472. 	end</del></li>
					
				
						<li><del>473. 	</del></li>
					
				
						<li><del>474. 	def end_of_table_cell?</del></li>
					
				
						<li><del>475. 		return true if @scanner.eos?</del></li>
					
				
						<li><del>476. 		return true if @scanner.check(/\n/)</del></li>
					
				
						<li><del>477. 		return true if @scanner.check(/\|\s*\n/)</del></li>
					
				
						<li><del>478. 		@scanner.scan(/\|/)</del></li>
					
				
						<li><del>479. 	end</del></li>
					
				
						<li><del>480. 	</del></li>
					
				
						<li><del>481. 	# Now some random helper methods for decoding</del></li>
					
				
						<li><del>482. 	</del></li>
					
				
						<li><del>483. 	def list_ordered?</del></li>
					
				
						<li><del>484. 		@scanner.matched[0,1] == '#'</del></li>
					
				
						<li><del>485. 	end</del></li>
					
				
						<li><del>486. 	</del></li>
					
				
						<li><del>487. 	def list_depth</del></li>
					
				
						<li><del>488. 		@scanner[1].size</del></li>
					
				
						<li><del>489. 	end</del></li>
					
				
						<li><del>490. 	</del></li>
					
				
						<li><del>491. 	def htmlesc( str )</del></li>
					
				
						<li><del>492.         str.gsub!( '&', '&amp;' )</del></li>
					
				
						<li><del>493.         str.gsub!( '"', '&quot;' )</del></li>
					
				
						<li><del>494.         str.gsub!( '&lt;', '&lt;')</del></li>
					
				
						<li><del>495.         str.gsub!( '&gt;', '&gt;')</del></li>
					
				
						<li><del>496.         str</del></li>
					
				
						<li><del>497.     end</del></li>
					
				
						<li><del>498. 	</del></li>
					
				
						<li><del>499. 	# Now the low level matching functions</del></li>
					
				
						<li><del>500. 	</del></li>
					
				
						<li><del>501. 	def add_to_html( object )</del></li>
					
				
						<li><del>502. 		@html &lt;&lt; object.to_s</del></li>
					
				
						<li><del>503. 	end</del></li>
					
				
						<li><del>504. 	</del></li>
					
				
						<li><del>505. 	def html</del></li>
					
				
						<li><del>506. 		@html</del></li>
					
				
						<li><del>507. 	end</del></li>
					
				
						<li><del>508. 	</del></li>
					
				
						<li><del>509. 	def reset</del></li>
					
				
						<li><del>510. 		@html, @scanner = "" , StringScanner.new( @text )</del></li>
					
				
						<li><del>511. 		@aliases = {}</del></li>
					
				
						<li><del>512. 		@indent = 0</del></li>
					
				
						<li><del>513. 	end	</del></li>
					
				
						<li><del>514. end</del></li>
					
				
						<li><del>515. &lt;/code&gt;</del></li>
					
				
						<li><del>516. &lt;/pre&gt;</del></li>
					
				
					
		</ol>
		<form method=post action='http://tom.counsell.org/rollback/AReWriteOfRedclothTextileToHtmlConvertor' >
			<input name='revision' value='1' type='hidden' />
			<input name='action' value='Undo the changes above' type='submit' />
		</form>
	</div>		

	<div class="undochange">
		<p>Tue Aug 09 04:42:57 -0400 2005 by <a href='../view/Tamc.html'>tamc</a></p>
		<ol>	
		
				
						<li><del>4. &lt;div class='ruby'&gt;</del></li>
					
				
						<li><del>5. &lt;pre&gt;&lt;span class="ident"&gt;require&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;strscan&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</del></li>
					
				
						<li>4. &lt;pre&gt;</li>
					
				
						<li>5. &lt;code&gt;</li>
					
				
						<li>6. require 'strscan'</li>
					
				
		
				
						<li><del>7. &lt;span class="comment"&gt;# Note: Does not implement anything beyond that on http://hobix.com/textile/&lt;/span&gt;</del></li>
					
				
						<li><del>8. &lt;span class="comment"&gt;# i.e. No markdown, link titles, and converting out of range ASCII&lt;/span&gt;</del></li>
					
				
						<li><del>9. &lt;span class="comment"&gt;# AND IT IS MUCH SLOWER THAN REDCLOTH !!&lt;/span&gt;</del></li>
					
				
						<li><del>10. &lt;span class="comment"&gt;#&lt;/span&gt;</del></li>
					
				
						<li><del>11. &lt;span class="comment"&gt;# Bodged together in a few evenings by Tom Counsell (tamc2@cam.ac.uk)&lt;/span&gt;</del></li>
					
				
						<li><del>12. &lt;span class="comment"&gt;# Feel free to do whatever you like with the code.&lt;/span&gt;</del></li>
					
				
						<li><del>13. &lt;span class="comment"&gt;#&lt;/span&gt;</del></li>
					
				
						<li><del>14. &lt;span class="comment"&gt;# Use is the same as for Redcloth (except that none of the options work):&lt;/span&gt;</del></li>
					
				
						<li><del>15. &lt;span class="comment"&gt;# html = TextileParser.new( &quot;textile string&quot;).to_html &lt;/span&gt;</del></li>
					
				
						<li><del>16. &lt;span class="comment"&gt;#&lt;/span&gt;</del></li>
					
				
						<li><del>17. &lt;span class="keyword"&gt;class &lt;/span&gt;&lt;span class="class"&gt;TextileParser&lt;/span&gt;</del></li>
					
				
						<li>8. # Note: Does not implement anything beyond that on http://hobix.com/textile/</li>
					
				
						<li>9. # i.e. No markdown, link titles, and converting out of range ASCII</li>
					
				
						<li>10. # AND IT IS MUCH SLOWER THAN REDCLOTH !!</li>
					
				
						<li>11. #</li>
					
				
						<li>12. # Bodged together in a few evenings by Tom Counsell (tamc2@cam.ac.uk)</li>
					
				
						<li>13. # Feel free to do whatever you like with the code.</li>
					
				
						<li>14. #</li>
					
				
						<li>15. # Use is the same as for Redcloth (except that none of the options work):</li>
					
				
						<li>16. # html = TextileParser.new( "textile string").to_html </li>
					
				
						<li>17. #</li>
					
				
						<li>18. class TextileParser</li>
					
				
		
				
						<li><del>19. 	&lt;span class="comment"&gt;# These are applied first&lt;/span&gt;</del></li>
					
				
						<li><del>20. 	&lt;span class="constant"&gt;BLOCK_COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</del></li>
					
				
						<li><del>21. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;pre.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:pre_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; </del></li>
					
				
						<li><del>22. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;code.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:code_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>23. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;notextile.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:notextile_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>24. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;h(&lt;span class="escape"&gt;\d&lt;/span&gt;)(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:heading_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>25. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;bq(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:quote_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>26. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\*&lt;/span&gt;+|&lt;span class="escape"&gt;\#&lt;/span&gt;+)&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt;  &lt;span class="symbol"&gt;:list_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>27. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;table(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:table_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>28. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:unspecified_table_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>29. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\{&lt;/span&gt;.+?&lt;span class="escape"&gt;\}\.\s&lt;/span&gt;+&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:unspecified_table_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# A styled table row		&lt;/span&gt;</del></li>
					
				
						<li><del>30. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;p(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:paragraph_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>31. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;fn(&lt;span class="escape"&gt;\d&lt;/span&gt;+)(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:footnote_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>32. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\S&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:unspecified_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>33. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:skip&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>34. 	&lt;span class="punct"&gt;]&lt;/span&gt;</del></li>
					
				
						<li>20. 	# These are applied first</li>
					
				
						<li>21. 	BLOCK_COMMANDS = [</li>
					
				
						<li>22. 		[ /&lt;pre.*?&gt;/, :pre_tag ], </li>
					
				
						<li>23. 		[ /&lt;code.*?&gt;/, :code_tag ],</li>
					
				
						<li>24. 		[ /&lt;notextile.*?&gt;/, :notextile_tag ],</li>
					
				
						<li>25. 		[ /h(\d)(.*?)\.\s+/i, :heading_block ],</li>
					
				
						<li>26. 		[ /bq(.*?)\.\s+/i, :quote_block ],</li>
					
				
						<li>27. 		[ /(\*+|\#+)\s+/,  :list_block ],</li>
					
				
						<li>28. 		[ /table(.*?)\.\s+/i, :table_block ],</li>
					
				
						<li>29. 		[ /\|/i, :unspecified_table_block ],</li>
					
				
						<li>30. 		[ /\{.+?\}\.\s+\|/i, :unspecified_table_block ], # A styled table row		</li>
					
				
						<li>31. 		[ /p(.*?)\.\s+/i, :paragraph_block ],</li>
					
				
						<li>32. 		[ /fn(\d+)(.*?)\.\s+/i, :footnote_block ],</li>
					
				
						<li>33. 		[ /\S+/i, :unspecified_block ],</li>
					
				
						<li>34. 		[ /\s+/i, :skip ],</li>
					
				
						<li>35. 	]</li>
					
				
		
				
						<li><del>36. 	&lt;span class="comment"&gt;# Then these&lt;/span&gt;</del></li>
					
				
						<li><del>37. 	&lt;span class="constant"&gt;COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</del></li>
					
				
						<li><del>38. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;pre.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:pre_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# Can be inline as well as in a block&lt;/span&gt;</del></li>
					
				
						<li><del>39. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;code.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:code_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;  &lt;span class="comment"&gt;# Can be inline as well as in a block&lt;/span&gt;</del></li>
					
				
						<li><del>40. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;notextile.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:notextile_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;  &lt;span class="comment"&gt;# Can be inline as well as in a block&lt;/span&gt;</del></li>
					
				
						<li><del>41. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;@(&lt;span class="escape"&gt;\S&lt;/span&gt;.*?&lt;span class="escape"&gt;\S&lt;/span&gt;)@&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:quick_escape_code&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; </del></li>
					
				
						<li><del>42. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&quot;(.+?)&quot;:(&lt;span class="escape"&gt;\S&lt;/span&gt;*&lt;span class="escape"&gt;\w\/&lt;/span&gt;?)&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:textile_link&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>43. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\[&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\]&lt;/span&gt;:(&lt;span class="escape"&gt;\S&lt;/span&gt;*&lt;span class="escape"&gt;\w\/&lt;/span&gt;?)&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:textile_link_alias&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>44. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;!(.+?)!(&lt;span class="escape"&gt;\S&lt;/span&gt;*)&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:image_link&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>45. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;([A-Z0-9]+)&lt;span class="escape"&gt;\(&lt;/span&gt;(.*?)&lt;span class="escape"&gt;\)&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:acronym&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>46. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\S&lt;/span&gt;+?)&lt;span class="escape"&gt;\[&lt;/span&gt;(&lt;span class="escape"&gt;\d&lt;/span&gt;+)&lt;span class="escape"&gt;\]&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:footnote&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt;</del></li>
					
				
						<li><del>47. 	&lt;span class="punct"&gt;]&lt;/span&gt;	</del></li>
					
				
						<li>37. 	# Then these</li>
					
				
						<li>38. 	COMMANDS = [</li>
					
				
						<li>39. 		[ /&lt;pre.*?&gt;/, :pre_tag ], # Can be inline as well as in a block</li>
					
				
						<li>40. 		[ /&lt;code.*?&gt;/, :code_tag ],  # Can be inline as well as in a block</li>
					
				
						<li>41. 		[ /&lt;notextile.*?&gt;/, :notextile_tag ],  # Can be inline as well as in a block</li>
					
				
						<li>42. 		[ /@(\S.*?\S)@/, :quick_escape_code ], </li>
					
				
						<li>43. 		[ /"(.+?)":(\S*\w\/?)/, :textile_link ],</li>
					
				
						<li>44. 		[ /\[(.+?)\]:(\S*\w\/?)/, :textile_link_alias ],</li>
					
				
						<li>45. 		[ /!(.+?)!(\S*)/, :image_link ],</li>
					
				
						<li>46. 		[ /([A-Z0-9]+)\((.*?)\)/, :acronym ],</li>
					
				
						<li>47. 		[ /(\S+?)\[(\d+)\]/, :footnote ]</li>
					
				
						<li>48. 	]	</li>
					
				
		
				
						<li><del>49. 	&lt;span class="comment"&gt;# Bit of a bodge, but need a different definition of phrase and whitespace in a table&lt;/span&gt;</del></li>
					
				
						<li><del>50. 	&lt;span class="constant"&gt;INLINE_COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;+&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</del></li>
					
				
						<li><del>51. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\S&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:phrase&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>52. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:space&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>53. 	&lt;span class="punct"&gt;]&lt;/span&gt;</del></li>
					
				
						<li>50. 	# Bit of a bodge, but need a different definition of phrase and whitespace in a table</li>
					
				
						<li>51. 	INLINE_COMMANDS = COMMANDS + [</li>
					
				
						<li>52. 		[ /\S+/i, :phrase ],</li>
					
				
						<li>53. 		[ /\s+/i, :space ],</li>
					
				
						<li>54. 	]</li>
					
				
		
				
						<li><del>55. 	&lt;span class="constant"&gt;TABLE_INLINE_COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;+&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</del></li>
					
				
						<li><del>56. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;[^&lt;span class="escape"&gt;\s\t\r\n\f\|&lt;/span&gt;]+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:phrase&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>57. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:space&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>58. 	&lt;span class="punct"&gt;]&lt;/span&gt;		</del></li>
					
				
						<li>56. 	TABLE_INLINE_COMMANDS = COMMANDS + [</li>
					
				
						<li>57. 		[ /[^\s\t\r\n\f\|]+/i, :phrase ],</li>
					
				
						<li>58. 		[ /\s+/i, :space ],</li>
					
				
						<li>59. 	]		</li>
					
				
		
				
						<li><del>60. 	&lt;span class="comment"&gt;# Then these are applied to phrases from above&lt;/span&gt;</del></li>
					
				
						<li><del>61. 	&lt;span class="constant"&gt;PHRASE_MODIFIERS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt; </del></li>
					
				
						<li><del>62. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;__&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>63. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;**&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;b&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>64. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;_&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;em&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>65. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;*&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;strong&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>66. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;??&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;cite&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>67. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;-&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;del&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>68. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;+&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ins&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>69. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;^&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;sup&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>70. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;~&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;sub&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</del></li>
					
				
						<li><del>71. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;%&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;span&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# How to avoid when people use % as in 3.0% growth?&lt;/span&gt;</del></li>
					
				
						<li><del>72. 		&lt;span class="punct"&gt;].&lt;/span&gt;&lt;span class="ident"&gt;collect!&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^&lt;span class="expr"&gt;#{Regexp.escape(regexp)}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="expr"&gt;#{Regexp.escape(regexp)}&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt;</del></li>
					
				
						<li>61. 	# Then these are applied to phrases from above</li>
					
				
						<li>62. 	PHRASE_MODIFIERS = [ </li>
					
				
						<li>63. 		[ '__', 'i' ],</li>
					
				
						<li>64. 		[ '**', 'b' ],</li>
					
				
						<li>65. 		[ '_', 'em' ],</li>
					
				
						<li>66. 		[ '*', 'strong' ],</li>
					
				
						<li>67. 		[ '??', 'cite' ],</li>
					
				
						<li>68. 		[ '-', 'del' ],</li>
					
				
						<li>69. 		[ '+', 'ins' ],</li>
					
				
						<li>70. 		[ '^', 'sup' ],</li>
					
				
						<li>71. 		[ '~', 'sub' ],</li>
					
				
						<li>72. 		[ '%', 'span' ], # How to avoid when people use % as in 3.0% growth?</li>
					
				
						<li>73. 		].collect! { |regexp,tag| [ /^#{Regexp.escape(regexp)}/, /#{Regexp.escape(regexp)}$/, tag ] }</li>
					
				
		
				
						<li><del>74. 	&lt;span class="comment"&gt;# Character substitutions done last to any words&lt;/span&gt;</del></li>
					
				
						<li><del>75. 	&lt;span class="constant"&gt;GLYPHS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</del></li>
					
				
						<li><del>76. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^&lt;span class="escape"&gt;\'&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8216;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# single opening&lt;/span&gt;</del></li>
					
				
						<li><del>77. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^&quot;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# double opening&lt;/span&gt;</del></li>
					
				
						<li><del>78. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\'&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8217;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# single closing&lt;/span&gt;</del></li>
					
				
						<li><del>79.        	&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8221;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# double closing&lt;/span&gt;</del></li>
					
				
						<li><del>80.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\.&lt;/span&gt;{3}$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;\1&amp;#8230;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# ellipsis&lt;/span&gt;</del></li>
					
				
						<li><del>81.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;--&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;\1&amp;#8212;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# em dash&lt;/span&gt;</del></li>
					
				
						<li><del>82.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;-&gt;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt; &amp;rarr; &lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# right arrow&lt;/span&gt;</del></li>
					
				
						<li><del>83.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;-$&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt; &amp;#8211; &lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# en dash&lt;/span&gt;</del></li>
					
				
						<li>75. 	# Character substitutions done last to any words</li>
					
				
						<li>76. 	GLYPHS = [</li>
					
				
						<li>77. 		[ /^\'/, '&#8216;' ], # single opening</li>
					
				
						<li>78. 		[ /^"/, '&#8220;' ], # double opening</li>
					
				
						<li>79. 		[ /\'$/, '&#8217;' ], # single closing</li>
					
				
						<li>80.        	[ /\"$/, '&#8221;' ], # double closing</li>
					
				
						<li>81.         [ /\.{3}$/, '\1&#8230;' ], # ellipsis</li>
					
				
						<li>82.         [ '--', '\1&#8212;' ], # em dash</li>
					
				
						<li>83.         [ '-&gt;', ' &rarr; ' ], # right arrow</li>
					
				
						<li>84.         [ '-$', ' &#8211; ' ], # en dash</li>
					
				
		
				
						<li><del>85.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;(TM)&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8482;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# trademark&lt;/span&gt;</del></li>
					
				
						<li><del>86.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;(R)&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#174;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# registered&lt;/span&gt;</del></li>
					
				
						<li><del>87.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;(C)&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#169;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="comment"&gt;# copyright&lt;/span&gt;</del></li>
					
				
						<li><del>88.     &lt;span class="punct"&gt;]&lt;/span&gt;</del></li>
					
				
						<li>86.         [ '(TM)', '&#8482;' ], # trademark</li>
					
				
						<li>87.         [ '(R)', '&#174;' ], # registered</li>
					
				
						<li>88.         [ '(C)', '&#169;' ] # copyright</li>
					
				
						<li>89.     ]</li>
					
				
		
				
						<li><del>90. 	&lt;span class="comment"&gt;# This is just used to give the ouput html a more beautiful layout&lt;/span&gt;</del></li>
					
				
						<li><del>91. 	&lt;span class="comment"&gt;# All tags in here will get a newline after they are output&lt;/span&gt;</del></li>
					
				
						<li><del>92. 	&lt;span class="comment"&gt;# and the indent for following lines increased by the number&lt;/span&gt;</del></li>
					
				
						<li><del>93. 	&lt;span class="constant"&gt;INDENTING_TAGS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; 	&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ul&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>94. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ol&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>95. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;li&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>96. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;blockquote&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>97. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;table&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>98. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;tr&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>99. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;td&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>100. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;th&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>101. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</del></li>
					
				
						<li><del>102. 					 &lt;span class="punct"&gt;}&lt;/span&gt;</del></li>
					
				
						<li>91. 	# This is just used to give the ouput html a more beautiful layout</li>
					
				
						<li>92. 	# All tags in here will get a newline after they are output</li>
					
				
						<li>93. 	# and the indent for following lines increased by the number</li>
					
				
						<li>94. 	INDENTING_TAGS = { 	'ul' =&gt; 1,</li>
					
				
						<li>95. 						'ol' =&gt; 1,</li>
					
				
						<li>96. 						'li' =&gt; 0,</li>
					
				
						<li>97. 						'blockquote' =&gt; 1,</li>
					
				
						<li>98. 						'table' =&gt; 1,</li>
					
				
						<li>99. 						'tr' =&gt; 1,</li>
					
				
						<li>100. 						'td' =&gt; 0,</li>
					
				
						<li>101. 						'th' =&gt; 0,</li>
					
				
						<li>102. 						'p' =&gt; 0,</li>
					
				
						<li>103. 					 }</li>
					
				
		
				
						<li><del>104. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;initialize&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;text&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>105. 		&lt;span class="attribute"&gt;@text&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;text&lt;/span&gt;</del></li>
					
				
						<li><del>106. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>105. 	def initialize( text )</li>
					
				
						<li>106. 		@text = text</li>
					
				
						<li>107. 	end</li>
					
				
		
				
						<li><del>108. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;settings&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;nil&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>109. 		&lt;span class="ident"&gt;reset&lt;/span&gt;</del></li>
					
				
						<li><del>110. 		&lt;span class="ident"&gt;convert_text&lt;/span&gt;</del></li>
					
				
						<li><del>111. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="ident"&gt;html&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;chomp&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;chomp&lt;/span&gt; &lt;span class="comment"&gt;# the tests don't have any trailing \ns&lt;/span&gt;</del></li>
					
				
						<li><del>112. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>109. 	def to_html( settings = nil )</li>
					
				
						<li>110. 		reset</li>
					
				
						<li>111. 		convert_text</li>
					
				
						<li>112. 		return html.chomp.chomp # the tests don't have any trailing \ns</li>
					
				
						<li>113. 	end</li>
					
				
		
				
						<li><del>114. 	&lt;span class="ident"&gt;private&lt;/span&gt;</del></li>
					
				
						<li>115. 	private</li>
					
				
		
				
						<li><del>116. 	&lt;span class="comment"&gt;## Methods dealing with blocks of text are called first&lt;/span&gt;</del></li>
					
				
						<li>117. 	## Methods dealing with blocks of text are called first</li>
					
				
		
				
						<li><del>118. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;convert_text&lt;/span&gt;</del></li>
					
				
						<li><del>119. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</del></li>
					
				
						<li><del>120. 			&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;BLOCK_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>121. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="comment"&gt;# Prettier html if extra space between blocks &lt;/span&gt;</del></li>
					
				
						<li><del>122. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>123. 		&lt;span class="ident"&gt;insert_any_link_aliases&lt;/span&gt;</del></li>
					
				
						<li><del>124. 		&lt;span class="ident"&gt;html&lt;/span&gt;</del></li>
					
				
						<li><del>125. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>119. 	def convert_text</li>
					
				
						<li>120. 		until @scanner.eos?</li>
					
				
						<li>121. 			send( BLOCK_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</li>
					
				
						<li>122. 			add_to_html "\n" # Prettier html if extra space between blocks </li>
					
				
						<li>123. 		end</li>
					
				
						<li>124. 		insert_any_link_aliases</li>
					
				
						<li>125. 		html</li>
					
				
						<li>126. 	end</li>
					
				
		
				
						<li><del>127. 	&lt;span class="comment"&gt;# These are all the block commands&lt;/span&gt;</del></li>
					
				
						<li>128. 	# These are all the block commands</li>
					
				
		
				
						<li><del>129. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;paragraph_block&lt;/span&gt;</del></li>
					
				
						<li><del>130. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </del></li>
					
				
						<li><del>131. 			&lt;span class="ident"&gt;standard_paragraph&lt;/span&gt;</del></li>
					
				
						<li><del>132. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>133. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>130. 	def paragraph_block</li>
					
				
						<li>131. 		tag( 'p', parse_attributes( @scanner[1] ) ) do </li>
					
				
						<li>132. 			standard_paragraph</li>
					
				
						<li>133. 		end</li>
					
				
						<li>134. 	end</li>
					
				
		
				
						<li><del>135. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;quote_block&lt;/span&gt;</del></li>
					
				
						<li><del>136. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;blockquote&lt;/span&gt;&lt;span class="punct"&gt;&quot;,&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>137. 			&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>138. 				&lt;span class="ident"&gt;standard_paragraph&lt;/span&gt;</del></li>
					
				
						<li><del>139. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>140. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>141. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>136. 	def quote_block</li>
					
				
						<li>137. 		tag( "blockquote", parse_attributes( @scanner[1] ) ) do</li>
					
				
						<li>138. 			tag 'p' do</li>
					
				
						<li>139. 				standard_paragraph</li>
					
				
						<li>140. 			end</li>
					
				
						<li>141. 		end</li>
					
				
						<li>142. 	end</li>
					
				
		
				
						<li><del>143. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;unspecified_block&lt;/span&gt;</del></li>
					
				
						<li><del>144. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;unscan&lt;/span&gt;</del></li>
					
				
						<li><del>145. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>146. 			&lt;span class="ident"&gt;standard_paragraph&lt;/span&gt;</del></li>
					
				
						<li><del>147. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>148. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>144. 	def unspecified_block</li>
					
				
						<li>145. 		@scanner.unscan</li>
					
				
						<li>146. 		tag 'p' do</li>
					
				
						<li>147. 			standard_paragraph</li>
					
				
						<li>148. 		end</li>
					
				
						<li>149. 	end</li>
					
				
		
				
						<li><del>150. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;heading_block&lt;/span&gt;</del></li>
					
				
						<li><del>151. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;h&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;,&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>152. 			&lt;span class="ident"&gt;standard_line&lt;/span&gt; &lt;span class="comment"&gt;# Assume titles may only be on one line&lt;/span&gt;</del></li>
					
				
						<li><del>153. 		&lt;span class="keyword"&gt;end&lt;/span&gt; </del></li>
					
				
						<li><del>154. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>151. 	def heading_block</li>
					
				
						<li>152. 		tag( "h#{@scanner[1]}", parse_attributes( @scanner[2] ) ) do</li>
					
				
						<li>153. 			standard_line # Assume titles may only be on one line</li>
					
				
						<li>154. 		end </li>
					
				
						<li>155. 	end</li>
					
				
		
				
						<li><del>156. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_block&lt;/span&gt;</del></li>
					
				
						<li><del>157. 		&lt;span class="ident"&gt;ordered&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;list_ordered?&lt;/span&gt; &lt;span class="comment"&gt;# See what sort of list we have&lt;/span&gt;</del></li>
					
				
						<li><del>158. 		&lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;list_depth&lt;/span&gt;</del></li>
					
				
						<li><del>159. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;unscan&lt;/span&gt; &lt;span class="comment"&gt;# So that the lines can be scanned individually&lt;/span&gt;</del></li>
					
				
						<li><del>160. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ol&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ul&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>161. 			&lt;span class="ident"&gt;list_line&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_list?&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>162. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>163. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>157. 	def list_block</li>
					
				
						<li>158. 		ordered = list_ordered? # See what sort of list we have</li>
					
				
						<li>159. 		depth = list_depth</li>
					
				
						<li>160. 		@scanner.unscan # So that the lines can be scanned individually</li>
					
				
						<li>161. 		tag( ordered ? 'ol' : 'ul' ) do</li>
					
				
						<li>162. 			list_line( ordered, depth ) until end_of_list?( depth )</li>
					
				
						<li>163. 		end</li>
					
				
						<li>164. 	end</li>
					
				
		
				
						<li><del>165. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;table_block&lt;/span&gt;</del></li>
					
				
						<li><del>166. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;table&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>167. 			&lt;span class="ident"&gt;table_line&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;</del></li>
					
				
						<li><del>168. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>169. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>166. 	def table_block</li>
					
				
						<li>167. 		tag( 'table', parse_attributes( @scanner[1] ) ) do</li>
					
				
						<li>168. 			table_line until end_of_paragraph?</li>
					
				
						<li>169. 		end</li>
					
				
						<li>170. 	end</li>
					
				
		
				
						<li><del>171. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;unspecified_table_block&lt;/span&gt;</del></li>
					
				
						<li><del>172. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;unscan&lt;/span&gt;</del></li>
					
				
						<li><del>173. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;table&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>174. 			&lt;span class="ident"&gt;table_line&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;</del></li>
					
				
						<li><del>175. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>176. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>172. 	def unspecified_table_block</li>
					
				
						<li>173. 		@scanner.unscan</li>
					
				
						<li>174. 		tag( 'table' ) do</li>
					
				
						<li>175. 			table_line until end_of_paragraph?</li>
					
				
						<li>176. 		end</li>
					
				
						<li>177. 	end</li>
					
				
		
				
						<li><del>178. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;footnote_block&lt;/span&gt;</del></li>
					
				
						<li><del>179. 		&lt;span class="ident"&gt;number&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt;</del></li>
					
				
						<li><del>180. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>181. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:id&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;fn&lt;span class="expr"&gt;#{number}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>182. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>183. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;sup&gt;&lt;span class="expr"&gt;#{number}&lt;/span&gt;&lt;/sup&gt; &lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>184. 			&lt;span class="ident"&gt;standard_line&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;</del></li>
					
				
						<li><del>185. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>186. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>179. 	def footnote_block</li>
					
				
						<li>180. 		number = @scanner[1]</li>
					
				
						<li>181. 		attributes = parse_attributes( @scanner[2] )</li>
					
				
						<li>182. 		attributes[:id] = "fn#{number}"</li>
					
				
						<li>183. 		tag 'p', attributes do</li>
					
				
						<li>184. 			add_to_html "&lt;sup&gt;#{number}&lt;/sup&gt; "</li>
					
				
						<li>185. 			standard_line until end_of_paragraph?</li>
					
				
						<li>186. 		end</li>
					
				
						<li>187. 	end</li>
					
				
		
				
						<li><del>188. 	&lt;span class="comment"&gt;# Now descend into methods dealing with lines of text&lt;/span&gt;</del></li>
					
				
						<li>189. 	# Now descend into methods dealing with lines of text</li>
					
				
		
				
						<li><del>190. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;pre_tag&lt;/span&gt;</del></li>
					
				
						<li><del>191. 		&lt;span class="ident"&gt;escape_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;pre&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</del></li>
					
				
						<li><del>192. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>191. 	def pre_tag</li>
					
				
						<li>192. 		escape_tag 'pre'</li>
					
				
						<li>193. 	end</li>
					
				
		
				
						<li><del>194. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;code_tag&lt;/span&gt;</del></li>
					
				
						<li><del>195. 		&lt;span class="ident"&gt;escape_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;code&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</del></li>
					
				
						<li><del>196. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>195. 	def code_tag</li>
					
				
						<li>196. 		escape_tag 'code'</li>
					
				
						<li>197. 	end</li>
					
				
		
				
						<li><del>198. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;notextile_tag&lt;/span&gt;</del></li>
					
				
						<li><del>199. 		&lt;span class="ident"&gt;escape_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;notextile&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="constant"&gt;false&lt;/span&gt;</del></li>
					
				
						<li><del>200. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>199. 	def notextile_tag</li>
					
				
						<li>200. 		escape_tag 'notextile', false</li>
					
				
						<li>201. 	end</li>
					
				
		
				
						<li><del>202. 	&lt;span class="comment"&gt;# This escapes until a matching close tag&lt;/span&gt;</del></li>
					
				
						<li><del>203. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;escape_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;include_tag_in_output&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>204. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;include_tag_in_output&lt;/span&gt;</del></li>
					
				
						<li><del>205. 		&lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;</del></li>
					
				
						<li><del>206. 		&lt;span class="keyword"&gt;while&lt;/span&gt; &lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</del></li>
					
				
						<li><del>207. 			&lt;span class="keyword"&gt;break&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(.*?)(&lt;(&lt;span class="escape"&gt;\/&lt;/span&gt;)?&lt;span class="expr"&gt;#{tag}&lt;/span&gt;.*?&gt;)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;m&lt;/span&gt;&lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="comment"&gt;# Breaks if no closing tag&lt;/span&gt;</del></li>
					
				
						<li><del>208. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;||&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>209. 			&lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;+&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;3&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="punct"&gt;-&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>210. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</del></li>
					
				
						<li><del>211. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>212. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;include_tag_in_output&lt;/span&gt;</del></li>
					
				
						<li><del>213. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>203. 	# This escapes until a matching close tag</li>
					
				
						<li>204. 	def escape_tag( tag, include_tag_in_output = true )</li>
					
				
						<li>205. 		add_to_html( @scanner.matched ) if include_tag_in_output</li>
					
				
						<li>206. 		level = 1</li>
					
				
						<li>207. 		while level &gt; 0</li>
					
				
						<li>208. 			break unless @scanner.scan(/(.*?)(&lt;(\/)?#{tag}.*?&gt;)/m) # Breaks if no closing tag</li>
					
				
						<li>209. 			add_to_html( htmlesc( @scanner[1] || "" ) )</li>
					
				
						<li>210. 			level = level + ( @scanner[3] ? -1 : 1 )</li>
					
				
						<li>211. 			add_to_html( htmlesc( @scanner[2] ) ) unless level == 0</li>
					
				
						<li>212. 		end</li>
					
				
						<li>213. 		add_to_html "&lt;/#{tag}&gt;" if include_tag_in_output</li>
					
				
						<li>214. 	end</li>
					
				
		
				
						<li><del>215. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;quick_escape_code&lt;/span&gt;</del></li>
					
				
						<li><del>216. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;code&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </del></li>
					
				
						<li><del>217. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>218. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>219. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>216. 	def quick_escape_code</li>
					
				
						<li>217. 		tag 'code' do </li>
					
				
						<li>218. 			add_to_html( htmlesc( @scanner[1] ) )</li>
					
				
						<li>219. 		end</li>
					
				
						<li>220. 	end</li>
					
				
		
				
						<li><del>221. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_line&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>222. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;li&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>223. 			&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(#+|&lt;span class="escape"&gt;\*&lt;/span&gt;+)&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>224. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;list_ordered?&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;&amp;&amp;&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;list_depth&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>225. 				&lt;span class="ident"&gt;standard_line&lt;/span&gt;</del></li>
					
				
						<li><del>226. 			&lt;span class="keyword"&gt;else&lt;/span&gt; &lt;span class="comment"&gt;# Recursive for sub lists&lt;/span&gt;</del></li>
					
				
						<li><del>227. 				&lt;span class="ident"&gt;list_block&lt;/span&gt;</del></li>
					
				
						<li><del>228. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>229. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>230. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>222. 	def list_line( ordered, depth )</li>
					
				
						<li>223. 		tag 'li' do</li>
					
				
						<li>224. 			@scanner.scan(/(#+|\*+)\s+/)</li>
					
				
						<li>225. 			if ( list_ordered? == ordered ) && ( list_depth == depth )</li>
					
				
						<li>226. 				standard_line</li>
					
				
						<li>227. 			else # Recursive for sub lists</li>
					
				
						<li>228. 				list_block</li>
					
				
						<li>229. 			end</li>
					
				
						<li>230. 		end</li>
					
				
						<li>231. 	end</li>
					
				
		
				
						<li><del>232. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;table_line&lt;/span&gt;</del></li>
					
				
						<li><del>233. 		&lt;span class="comment"&gt;# Are their row attributes at that start of the line?&lt;/span&gt;</del></li>
					
				
						<li><del>234. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\{&lt;/span&gt;.+?&lt;span class="escape"&gt;\}&lt;/span&gt;)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;])&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt; 	</del></li>
					
				
						<li><del>235. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="comment"&gt;# Get rid of any leading cell opening&lt;/span&gt;</del></li>
					
				
						<li><del>236. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;tr&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </del></li>
					
				
						<li><del>237. 			&lt;span class="ident"&gt;table_cell&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_table_line?&lt;/span&gt;</del></li>
					
				
						<li><del>238. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>239. 	&lt;span class="keyword"&gt;end&lt;/span&gt;	</del></li>
					
				
						<li>233. 	def table_line</li>
					
				
						<li>234. 		# Are their row attributes at that start of the line?</li>
					
				
						<li>235. 		attributes = @scanner.scan(/(\{.+?\})\.\s+/) ? parse_attributes(@scanner[1]) : {} 	</li>
					
				
						<li>236. 		@scanner.scan(/\|/) # Get rid of any leading cell opening</li>
					
				
						<li>237. 		tag( 'tr', attributes ) do </li>
					
				
						<li>238. 			table_cell until end_of_table_line?</li>
					
				
						<li>239. 		end</li>
					
				
						<li>240. 	end	</li>
					
				
		
				
						<li><del>241. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;standard_paragraph&lt;/span&gt;</del></li>
					
				
						<li><del>242. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;	</del></li>
					
				
						<li><del>243. 			&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;INLINE_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>244. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>245. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>242. 	def standard_paragraph</li>
					
				
						<li>243. 		until end_of_paragraph?	</li>
					
				
						<li>244. 			send( INLINE_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</li>
					
				
						<li>245. 		end</li>
					
				
						<li>246. 	end</li>
					
				
		
				
						<li><del>247. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;standard_line&lt;/span&gt;</del></li>
					
				
						<li><del>248. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_line?&lt;/span&gt;</del></li>
					
				
						<li><del>249. 			&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;INLINE_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>250. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>251. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>248. 	def standard_line</li>
					
				
						<li>249. 		until end_of_line?</li>
					
				
						<li>250. 			send( INLINE_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</li>
					
				
						<li>251. 		end</li>
					
				
						<li>252. 	end</li>
					
				
		
				
						<li><del>253. 	&lt;span class="comment"&gt;# Now descend into methods dealing with phrases&lt;/span&gt;</del></li>
					
				
						<li>254. 	# Now descend into methods dealing with phrases</li>
					
				
		
				
						<li><del>255. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;table_cell&lt;/span&gt;</del></li>
					
				
						<li><del>256. 		&lt;span class="comment"&gt;# Style defined at start of cell ?&lt;/span&gt;</del></li>
					
				
						<li><del>257. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(_)?(&lt;span class="escape"&gt;\S&lt;/span&gt;*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;*&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt;  &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;])&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt;</del></li>
					
				
						<li><del>258. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;th&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;td&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </del></li>
					
				
						<li><del>259. 			&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_table_cell?&lt;/span&gt;</del></li>
					
				
						<li><del>260. 				&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;TABLE_INLINE_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>261. 			&lt;span class="keyword"&gt;end&lt;/span&gt;	</del></li>
					
				
						<li><del>262. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>263. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>256. 	def table_cell</li>
					
				
						<li>257. 		# Style defined at start of cell ?</li>
					
				
						<li>258. 		attributes = @scanner.scan(/(_)?(\S*?)\.\s*/) ?  parse_attributes(@scanner[2]) : {}</li>
					
				
						<li>259. 		tag( @scanner[1] ? 'th' : 'td', attributes) do </li>
					
				
						<li>260. 			until end_of_table_cell?</li>
					
				
						<li>261. 				send( TABLE_INLINE_COMMANDS.detect { |regexp, method| @scanner.scan( regexp ) }[1] )</li>
					
				
						<li>262. 			end	</li>
					
				
						<li>263. 		end</li>
					
				
						<li>264. 	end</li>
					
				
		
				
						<li><del>265. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;footnote&lt;/span&gt;</del></li>
					
				
						<li><del>266. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;sup&gt;&lt;a href=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;#fn&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&gt;&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>267. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>266. 	def footnote</li>
					
				
						<li>267. 		add_to_html "#{@scanner[1]}&lt;sup&gt;&lt;a href=\"#fn#{@scanner[2]}\"&gt;#{@scanner[2]}&lt;/a&gt;&lt;/sup&gt;"</li>
					
				
						<li>268. 	end</li>
					
				
		
				
						<li><del>269. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;acronym&lt;/span&gt;</del></li>
					
				
						<li><del>270. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;acronym title=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&gt;&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;/acronym&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>271. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>270. 	def acronym</li>
					
				
						<li>271. 		add_to_html "&lt;acronym title=\"#{@scanner[2]}\"&gt;#{@scanner[1]}&lt;/acronym&gt;"</li>
					
				
						<li>272. 	end</li>
					
				
		
				
						<li><del>273. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;phrase&lt;/span&gt;</del></li>
					
				
						<li><del>274. 		&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt;</del></li>
					
				
						<li>274. 	def phrase</li>
					
				
						<li>275. 		word = @scanner.matched</li>
					
				
		
				
						<li><del>276. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;parse_glyphs&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\w&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt; &lt;span class="comment"&gt;# If a word is entirely symbols then we will leave it in peace.&lt;/span&gt;</del></li>
					
				
						<li>277. 		return add_to_html( parse_glyphs( word ) ) unless word =~ /\w+/ # If a word is entirely symbols then we will leave it in peace.</li>
					
				
		
				
						<li><del>278. 		&lt;span class="comment"&gt;# Open tags&lt;/span&gt;</del></li>
					
				
						<li><del>279. 		&lt;span class="constant"&gt;PHRASE_MODIFIERS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;start_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;end_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</del></li>
					
				
						<li><del>280. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="ident"&gt;start_r&lt;/span&gt;</del></li>
					
				
						<li><del>281. 				&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$'&lt;/span&gt; &lt;span class="comment"&gt;# The bit after the match&lt;/span&gt;</del></li>
					
				
						<li><del>282. 				&lt;span class="comment"&gt;# Look for matching brackets that indicate there are attributes&lt;/span&gt;</del></li>
					
				
						<li><del>283. 				&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\(&lt;/span&gt;.+?&lt;span class="escape"&gt;\)&lt;/span&gt;|&lt;span class="escape"&gt;\{&lt;/span&gt;.+?&lt;span class="escape"&gt;\}&lt;/span&gt;|&lt;span class="escape"&gt;\[&lt;/span&gt;.+?&lt;span class="escape"&gt;\]&lt;/span&gt;)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt; 				</del></li>
					
				
						<li><del>284. 					&lt;span class="ident"&gt;open_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>285. 					&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$'&lt;/span&gt;</del></li>
					
				
						<li><del>286. 				&lt;span class="keyword"&gt;else&lt;/span&gt;</del></li>
					
				
						<li><del>287. 					&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</del></li>
					
				
						<li><del>288. 				&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>289. 				&lt;span class="keyword"&gt;break&lt;/span&gt;</del></li>
					
				
						<li><del>290. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>291. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>279. 		# Open tags</li>
					
				
						<li>280. 		PHRASE_MODIFIERS.each do |start_r, end_r, tag|</li>
					
				
						<li>281. 			if word =~ start_r</li>
					
				
						<li>282. 				word = $' # The bit after the match</li>
					
				
						<li>283. 				# Look for matching brackets that indicate there are attributes</li>
					
				
						<li>284. 				if word =~ /(\(.+?\)|\{.+?\}|\[.+?\])/ 				</li>
					
				
						<li>285. 					open_tag( tag, parse_attributes( $1 ) )</li>
					
				
						<li>286. 					word = $'</li>
					
				
						<li>287. 				else</li>
					
				
						<li>288. 					open_tag tag</li>
					
				
						<li>289. 				end</li>
					
				
						<li>290. 				break</li>
					
				
						<li>291. 			end</li>
					
				
						<li>292. 		end</li>
					
				
		
				
						<li><del>293. 		&lt;span class="comment"&gt;# Close tags&lt;/span&gt;</del></li>
					
				
						<li><del>294. 		&lt;span class="ident"&gt;end_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;nil&lt;/span&gt;</del></li>
					
				
						<li><del>295. 		&lt;span class="constant"&gt;PHRASE_MODIFIERS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;start_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;end_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</del></li>
					
				
						<li><del>296. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="ident"&gt;end_r&lt;/span&gt;</del></li>
					
				
						<li><del>297. 				&lt;span class="ident"&gt;end_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</del></li>
					
				
						<li><del>298. 				&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$`&lt;/span&gt; &lt;span class="comment"&gt;# The bit before the match&lt;/span&gt;</del></li>
					
				
						<li><del>299. 				&lt;span class="keyword"&gt;break&lt;/span&gt;</del></li>
					
				
						<li><del>300. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>301. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>302. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="ident"&gt;parse_glyphs&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>303. 		&lt;span class="ident"&gt;close_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;end_tag&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;end_tag&lt;/span&gt;</del></li>
					
				
						<li><del>304. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>294. 		# Close tags</li>
					
				
						<li>295. 		end_tag = nil</li>
					
				
						<li>296. 		PHRASE_MODIFIERS.each do |start_r, end_r, tag|</li>
					
				
						<li>297. 			if word =~ end_r</li>
					
				
						<li>298. 				end_tag = tag</li>
					
				
						<li>299. 				word = $` # The bit before the match</li>
					
				
						<li>300. 				break</li>
					
				
						<li>301. 			end</li>
					
				
						<li>302. 		end</li>
					
				
						<li>303. 		add_to_html parse_glyphs( word )</li>
					
				
						<li>304. 		close_tag( end_tag ) if end_tag</li>
					
				
						<li>305. 	end</li>
					
				
		
				
						<li><del>306. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;space&lt;/span&gt;</del></li>
					
				
						<li><del>307. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt;</del></li>
					
				
						<li><del>308. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>307. 	def space</li>
					
				
						<li>308. 		add_to_html @scanner.matched</li>
					
				
						<li>309. 	end</li>
					
				
		
				
						<li><del>310. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;image_link&lt;/span&gt;</del></li>
					
				
						<li><del>311. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^!([&lt;&gt;]*)(.*?)(!|&lt;span class="escape"&gt;\(&lt;/span&gt;(.*?)&lt;span class="escape"&gt;\)&lt;/span&gt;!)($|(:(.+?)$))&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>312. 		&lt;span class="ident"&gt;alignment&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;src&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;title&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;url&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$2&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$4&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$7&lt;/span&gt;</del></li>
					
				
						<li><del>313. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt;</del></li>
					
				
						<li><del>314. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;float:right&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;alignment&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</del></li>
					
				
						<li><del>315. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;float:left&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;alignment&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&lt;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</del></li>
					
				
						<li>311. 	def image_link</li>
					
				
						<li>312. 		@scanner.matched =~ /^!([&lt;&gt;]*)(.*?)(!|\((.*?)\)!)($|(:(.+?)$))/</li>
					
				
						<li>313. 		alignment, src, title, url = $1, $2, $4, $7</li>
					
				
						<li>314. 		attributes = {}</li>
					
				
						<li>315. 		attributes[:style] = 'float:right' if alignment == '&gt;'</li>
					
				
						<li>316. 		attributes[:style] = 'float:left' if alignment == '&lt;'</li>
					
				
		
				
						<li><del>317. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:src&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;src&lt;/span&gt;</del></li>
					
				
						<li><del>318. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:alt&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="symbol"&gt;:title&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;title&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;title&lt;/span&gt;</del></li>
					
				
						<li><del>319. 		&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;url&lt;/span&gt;</del></li>
					
				
						<li><del>320. 			&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="symbol"&gt;:href&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="ident"&gt;url&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</del></li>
					
				
						<li><del>321. 				&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;img&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt;</del></li>
					
				
						<li><del>322. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>323. 		&lt;span class="keyword"&gt;else&lt;/span&gt;</del></li>
					
				
						<li><del>324. 			&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;img&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt;</del></li>
					
				
						<li><del>325. 		&lt;span class="keyword"&gt;end&lt;/span&gt;	</del></li>
					
				
						<li><del>326. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>318. 		attributes[:src] = src</li>
					
				
						<li>319. 		attributes[:alt] = attributes[ :title ] = title if title</li>
					
				
						<li>320. 		if url</li>
					
				
						<li>321. 			tag 'a', { :href =&gt; url } do</li>
					
				
						<li>322. 				open_tag 'img', attributes, true</li>
					
				
						<li>323. 			end</li>
					
				
						<li>324. 		else</li>
					
				
						<li>325. 			open_tag 'img', attributes, true</li>
					
				
						<li>326. 		end	</li>
					
				
						<li>327. 	end</li>
					
				
		
				
						<li><del>328. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;skip&lt;/span&gt;</del></li>
					
				
						<li><del>329. 		&lt;span class="comment"&gt;# Do nothing !&lt;/span&gt;</del></li>
					
				
						<li><del>330. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>329. 	def skip</li>
					
				
						<li>330. 		# Do nothing !</li>
					
				
						<li>331. 	end</li>
					
				
		
				
						<li><del>332. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;textile_link&lt;/span&gt;</del></li>
					
				
						<li><del>333. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;a href=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&gt;&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>334. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>333. 	def textile_link</li>
					
				
						<li>334. 		add_to_html "&lt;a href=\"#{@scanner[2]}\"&gt;#{@scanner[1]}&lt;/a&gt;"</li>
					
				
						<li>335. 	end</li>
					
				
		
				
						<li><del>336. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;textile_link_alias&lt;/span&gt;</del></li>
					
				
						<li><del>337. 		&lt;span class="comment"&gt;# These are saved for later resubstitution&lt;/span&gt;</del></li>
					
				
						<li><del>338. 		&lt;span class="attribute"&gt;@aliases&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt;</del></li>
					
				
						<li><del>339. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>337. 	def textile_link_alias</li>
					
				
						<li>338. 		# These are saved for later resubstitution</li>
					
				
						<li>339. 		@aliases[ @scanner[1] ] = @scanner[2]</li>
					
				
						<li>340. 	end</li>
					
				
		
				
						<li><del>341. 	&lt;span class="comment"&gt;# These feels clunky, and is done last&lt;/span&gt;</del></li>
					
				
						<li><del>342. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;insert_any_link_aliases&lt;/span&gt;</del></li>
					
				
						<li><del>343. 		&lt;span class="attribute"&gt;@aliases&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;als&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;href&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</del></li>
					
				
						<li><del>344. 			&lt;span class="ident"&gt;html&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;href=&quot;&lt;span class="expr"&gt;#{als}&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;href=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{href}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>345. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>346. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>342. 	# These feels clunky, and is done last</li>
					
				
						<li>343. 	def insert_any_link_aliases</li>
					
				
						<li>344. 		@aliases.each do |als, href|</li>
					
				
						<li>345. 			html.gsub!( /href="#{als}"/, "href=\"#{href}\"" )</li>
					
				
						<li>346. 		end</li>
					
				
						<li>347. 	end</li>
					
				
		
				
						<li><del>348. 	&lt;span class="comment"&gt;# These are helper methods that make sure html is properly closed and indented&lt;/span&gt;</del></li>
					
				
						<li>349. 	# These are helper methods that make sure html is properly closed and indented</li>
					
				
		
				
						<li><del>350. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>351. 		&lt;span class="ident"&gt;open_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>352. 		&lt;span class="keyword"&gt;yield&lt;/span&gt;</del></li>
					
				
						<li><del>353. 		&lt;span class="ident"&gt;close_tag&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</del></li>
					
				
						<li><del>354. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>351. 	def tag( tag, attributes = {} )</li>
					
				
						<li>352. 		open_tag( tag, attributes )</li>
					
				
						<li>353. 		yield</li>
					
				
						<li>354. 		close_tag tag</li>
					
				
						<li>355. 	end</li>
					
				
		
				
						<li><del>356. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;close_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="symbol"&gt;:all_tags&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>357. 		&lt;span class="comment"&gt;# Check the tag has been opened&lt;/span&gt;</del></li>
					
				
						<li><del>358. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;open_tags&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;include?&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;||&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="symbol"&gt;:all_tags&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li>357. 	def close_tag( tag = :all_tags )</li>
					
				
						<li>358. 		# Check the tag has been opened</li>
					
				
						<li>359. 		return unless open_tags.include?( tag ) || ( tag == :all_tags )</li>
					
				
		
				
						<li><del>360. 		&lt;span class="comment"&gt;# Close all tags up to that tag (in case one was not closed)&lt;/span&gt;</del></li>
					
				
						<li><del>361. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;open_tags&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;empty?&lt;/span&gt;</del></li>
					
				
						<li><del>362. 			&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;open_tags&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;pop&lt;/span&gt;</del></li>
					
				
						<li><del>363. 			&lt;span class="comment"&gt;# This is just stuff to make the html look pretty&lt;/span&gt;</del></li>
					
				
						<li><del>364. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;INDENTING_TAGS&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; </del></li>
					
				
						<li><del>365. 				&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</del></li>
					
				
						<li><del>366. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{open_tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>367. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>368. 				&lt;span class="keyword"&gt;else&lt;/span&gt;</del></li>
					
				
						<li><del>369. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;html&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>370. 					&lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;-=&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt;</del></li>
					
				
						<li><del>371. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\t&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;*&lt;/span&gt; &lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>372. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{open_tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>373. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>374. 				&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>375. 			&lt;span class="keyword"&gt;else&lt;/span&gt;</del></li>
					
				
						<li><del>376. 				&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{open_tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>377. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>378. 			&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</del></li>
					
				
						<li><del>379. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>380. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>361. 		# Close all tags up to that tag (in case one was not closed)</li>
					
				
						<li>362. 		until open_tags.empty?</li>
					
				
						<li>363. 			open_tag = open_tags.pop</li>
					
				
						<li>364. 			# This is just stuff to make the html look pretty</li>
					
				
						<li>365. 			if (indent = INDENTING_TAGS[ open_tag ] ) </li>
					
				
						<li>366. 				if indent == 0</li>
					
				
						<li>367. 					add_to_html "&lt;/#{open_tag}&gt;"</li>
					
				
						<li>368. 					add_to_html "\n"</li>
					
				
						<li>369. 				else</li>
					
				
						<li>370. 					add_to_html "\n" unless html =~ /\n$/</li>
					
				
						<li>371. 					@indent -= indent</li>
					
				
						<li>372. 					add_to_html( "\t" * @indent )</li>
					
				
						<li>373. 					add_to_html "&lt;/#{open_tag}&gt;"</li>
					
				
						<li>374. 					add_to_html "\n"</li>
					
				
						<li>375. 				end</li>
					
				
						<li>376. 			else</li>
					
				
						<li>377. 				add_to_html "&lt;/#{open_tag}&gt;"</li>
					
				
						<li>378. 			end</li>
					
				
						<li>379. 			return if open_tag == tag</li>
					
				
						<li>380. 		end</li>
					
				
						<li>381. 	end</li>
					
				
		
				
						<li><del>382. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;open_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{},&lt;/span&gt; &lt;span class="ident"&gt;no_close_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;false&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>383. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\t&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;*&lt;/span&gt; &lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li>383. 	def open_tag( tag, attributes = {}, no_close_tag = false )</li>
					
				
						<li>384. 		add_to_html( "\t" * @indent )</li>
					
				
		
				
						<li><del>385. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;&lt;span class="expr"&gt;#{tag}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li>386. 		add_to_html "&lt;#{tag}"</li>
					
				
		
				
						<li><del>387. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;key&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;value&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; 	&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt; &lt;span class="expr"&gt;#{key.to_s}&lt;/span&gt;=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{value.to_s}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;	&lt;span class="punct"&gt;}&lt;/span&gt;</del></li>
					
				
						<li>388. 		attributes.each { |key, value| 	add_to_html( " #{key.to_s}=\"#{value.to_s}\"" )	}</li>
					
				
		
				
						<li><del>389. 		&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;no_close_tag&lt;/span&gt;</del></li>
					
				
						<li><del>390. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt; /&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>391. 			&lt;span class="keyword"&gt;return&lt;/span&gt;</del></li>
					
				
						<li><del>392. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>390. 		if no_close_tag</li>
					
				
						<li>391. 			add_to_html " /&gt;"</li>
					
				
						<li>392. 			return</li>
					
				
						<li>393. 		end</li>
					
				
		
				
						<li><del>394. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li>395. 		add_to_html "&gt;"</li>
					
				
		
				
						<li><del>396. 		&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;INDENTING_TAGS&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;			</del></li>
					
				
						<li><del>397. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</del></li>
					
				
						<li><del>398. 			&lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;+=&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt;</del></li>
					
				
						<li><del>399. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>400. 		&lt;span class="ident"&gt;open_tags&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</del></li>
					
				
						<li><del>401. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>397. 		if (indent = INDENTING_TAGS[ tag ] )			</li>
					
				
						<li>398. 			add_to_html "\n" unless indent == 0</li>
					
				
						<li>399. 			@indent += indent</li>
					
				
						<li>400. 		end</li>
					
				
						<li>401. 		open_tags &lt;&lt; tag</li>
					
				
						<li>402. 	end</li>
					
				
		
				
						<li><del>403. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;open_tags&lt;/span&gt;</del></li>
					
				
						<li><del>404. 		&lt;span class="attribute"&gt;@open_tags&lt;/span&gt; &lt;span class="punct"&gt;||=&lt;/span&gt; &lt;span class="punct"&gt;[]&lt;/span&gt;</del></li>
					
				
						<li><del>405. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>404. 	def open_tags</li>
					
				
						<li>405. 		@open_tags ||= []</li>
					
				
						<li>406. 	end</li>
					
				
		
				
						<li><del>407. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>408. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;&amp;&amp;&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;!=&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</del></li>
					
				
						<li><del>409. 		&lt;span class="ident"&gt;a&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="symbol"&gt;:style&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt;</del></li>
					
				
						<li>408. 	def parse_attributes( attribute_text )</li>
					
				
						<li>409. 		return {} unless attribute_text && attribute_text != ""</li>
					
				
						<li>410. 		a = { :style =&gt; "" }</li>
					
				
		
				
						<li><del>411. 		&lt;span class="comment"&gt;# The hand-entered classes, ids, styles and langs&lt;/span&gt;</del></li>
					
				
						<li><del>412. 		&lt;span class="comment"&gt;# These are replaced with &quot;&quot; so their content cannot be matched below&lt;/span&gt;</del></li>
					
				
						<li><del>413. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:lang&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\[&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\]&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>414. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:class&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;sub!&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\(&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\)&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,'&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</del></li>
					
				
						<li><del>415. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:class&lt;/span&gt;&lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:id&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$2&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:class&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt;  &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^(.*?)#(.*)$&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>416. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="expr"&gt;#{$1}&lt;/span&gt;;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;sub!&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\{&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,'&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</del></li>
					
				
						<li>412. 		# The hand-entered classes, ids, styles and langs</li>
					
				
						<li>413. 		# These are replaced with "" so their content cannot be matched below</li>
					
				
						<li>414. 		a[:lang] = $1 if attribute_text =~ /\[(.+?)\]/</li>
					
				
						<li>415. 		a[:class] = $1 if attribute_text.sub!(/\((.+?)\)/,'')</li>
					
				
						<li>416. 		a[:class], a[:id] = $1, $2 if a[:class] =~  /^(.*?)#(.*)$/</li>
					
				
						<li>417. 		a[:style] &lt;&lt; "#{$1};" if attribute_text.sub!(/\{(.+?)\}/,'')</li>
					
				
		
				
						<li><del>418. 		&lt;span class="comment"&gt;# Various padding and indents&lt;/span&gt;</del></li>
					
				
						<li><del>419. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;padding-left:&lt;span class="expr"&gt;#{ $1.length }&lt;/span&gt;em;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\(&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>420. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;padding-right:&lt;span class="expr"&gt;#{ $1.length }&lt;/span&gt;em;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\)&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;		</del></li>
					
				
						<li>419. 		# Various padding and indents</li>
					
				
						<li>420. 		a[:style] &lt;&lt; "padding-left:#{ $1.length }em;" if attribute_text =~ /(\(+)/</li>
					
				
						<li>421. 		a[:style] &lt;&lt; "padding-right:#{ $1.length }em;" if attribute_text =~ /(\)+)/		</li>
					
				
		
				
						<li><del>422. 		&lt;span class="comment"&gt;# The various alignments&lt;/span&gt;</del></li>
					
				
						<li><del>423. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:left;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;(?!&gt;)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>424. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:right;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(?!&lt;)&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>425. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:justify;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>426. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:center;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;=&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li>423. 		# The various alignments</li>
					
				
						<li>424. 		a[:style] &lt;&lt; "text-align:left;" if attribute_text =~ /&lt;(?!&gt;)/</li>
					
				
						<li>425. 		a[:style] &lt;&lt; "text-align:right;" if attribute_text =~ /(?!&lt;)&gt;/</li>
					
				
						<li>426. 		a[:style] &lt;&lt; "text-align:justify;" if attribute_text =~ /&lt;&gt;/</li>
					
				
						<li>427. 		a[:style] &lt;&lt; "text-align:center;" if attribute_text =~ /=/</li>
					
				
		
				
						<li><del>428. 		&lt;span class="comment"&gt;#Various column spans on tables&lt;/span&gt;</del></li>
					
				
						<li><del>429. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:colspan&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\\&lt;/span&gt;(&lt;span class="escape"&gt;\d&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>430. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:rowspan&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\/&lt;/span&gt;(&lt;span class="escape"&gt;\d&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li>429. 		#Various column spans on tables</li>
					
				
						<li>430. 		a[:colspan] = $1 if attribute_text =~ /\\(\d+)/</li>
					
				
						<li>431. 		a[:rowspan] = $1 if attribute_text =~ /\/(\d+)/</li>
					
				
		
				
						<li><del>432. 		&lt;span class="comment"&gt;#Vertical alignments on tables&lt;/span&gt;</del></li>
					
				
						<li><del>433. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;vertical-align:top;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\^&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li><del>434. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;vertical-align:bottom;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\~&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</del></li>
					
				
						<li>433. 		#Vertical alignments on tables</li>
					
				
						<li>434. 		a[:style] &lt;&lt; "vertical-align:top;" if attribute_text =~ /\^/</li>
					
				
						<li>435. 		a[:style] &lt;&lt; "vertical-align:bottom;" if attribute_text =~ /\~/</li>
					
				
		
				
						<li><del>436. 		&lt;span class="comment"&gt;# Get rid of any empty attributes before returning&lt;/span&gt;</del></li>
					
				
						<li><del>437. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;delete_if&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;k&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="ident"&gt;v&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="punct"&gt;!&lt;/span&gt;&lt;span class="ident"&gt;v&lt;/span&gt; &lt;span class="punct"&gt;||&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="ident"&gt;v&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;)&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt;</del></li>
					
				
						<li><del>438. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>437. 		# Get rid of any empty attributes before returning</li>
					
				
						<li>438. 		a.delete_if { |k,v| !v || (v == "") }</li>
					
				
						<li>439. 	end</li>
					
				
		
				
						<li><del>440. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;parse_glyphs&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>441. 		&lt;span class="constant"&gt;GLYPHS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="ident"&gt;replacement&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</del></li>
					
				
						<li><del>442. 			&lt;span class="ident"&gt;word&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;replacement&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>443. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li><del>444. 		&lt;span class="ident"&gt;word&lt;/span&gt;</del></li>
					
				
						<li><del>445. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>441. 	def parse_glyphs( word )</li>
					
				
						<li>442. 		GLYPHS.each do |regexp,replacement|</li>
					
				
						<li>443. 			word.gsub!( regexp, replacement )</li>
					
				
						<li>444. 		end</li>
					
				
						<li>445. 		word</li>
					
				
						<li>446. 	end</li>
					
				
		
				
						<li><del>447. 	&lt;span class="comment"&gt;# Now some helper methods for spotting the ends of sections&lt;/span&gt;</del></li>
					
				
						<li>448. 	# Now some helper methods for spotting the ends of sections</li>
					
				
		
				
						<li><del>449. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_paragraph?&lt;/span&gt;</del></li>
					
				
						<li><del>450. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</del></li>
					
				
						<li><del>451. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>452. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>450. 	def end_of_paragraph?</li>
					
				
						<li>451. 		return true if @scanner.eos?</li>
					
				
						<li>452. 		@scanner.scan(/\n{2,}/)</li>
					
				
						<li>453. 	end</li>
					
				
		
				
						<li><del>454. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_list?&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>455. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</del></li>
					
				
						<li><del>456. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(#+|&lt;span class="escape"&gt;\*&lt;/span&gt;+)&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="comment"&gt;# Not a list any more&lt;/span&gt;</del></li>
					
				
						<li><del>457. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;list_depth&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="comment"&gt;# End of this sub list&lt;/span&gt;</del></li>
					
				
						<li><del>458. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>459. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>455. 	def end_of_list?( depth )</li>
					
				
						<li>456. 		return true if @scanner.eos?</li>
					
				
						<li>457. 		return true unless @scanner.check(/(#+|\*+)\s+/) # Not a list any more</li>
					
				
						<li>458. 		return true if list_depth &lt; depth # End of this sub list</li>
					
				
						<li>459. 		@scanner.scan(/\n{2,}/)</li>
					
				
						<li>460. 	end</li>
					
				
		
				
						<li><del>461. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_line?&lt;/span&gt;</del></li>
					
				
						<li><del>462. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</del></li>
					
				
						<li><del>463. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>464. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>465. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>462. 	def end_of_line?</li>
					
				
						<li>463. 		return true if @scanner.eos?</li>
					
				
						<li>464. 		return true if @scanner.check(/\n{2,}/)</li>
					
				
						<li>465. 		@scanner.scan(/\n/)</li>
					
				
						<li>466. 	end</li>
					
				
		
				
						<li><del>467. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_table_line?&lt;/span&gt;</del></li>
					
				
						<li><del>468. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</del></li>
					
				
						<li><del>469. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>470. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|\s&lt;/span&gt;*&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>471. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>468. 	def end_of_table_line?</li>
					
				
						<li>469. 		return true if @scanner.eos?</li>
					
				
						<li>470. 		return true if @scanner.check(/\n{2,}/)</li>
					
				
						<li>471. 		@scanner.scan(/\|\s*\n/)</li>
					
				
						<li>472. 	end</li>
					
				
		
				
						<li><del>473. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_table_cell?&lt;/span&gt;</del></li>
					
				
						<li><del>474. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</del></li>
					
				
						<li><del>475. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>476. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|\s&lt;/span&gt;*&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>477. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</del></li>
					
				
						<li><del>478. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>474. 	def end_of_table_cell?</li>
					
				
						<li>475. 		return true if @scanner.eos?</li>
					
				
						<li>476. 		return true if @scanner.check(/\n/)</li>
					
				
						<li>477. 		return true if @scanner.check(/\|\s*\n/)</li>
					
				
						<li>478. 		@scanner.scan(/\|/)</li>
					
				
						<li>479. 	end</li>
					
				
		
				
						<li><del>480. 	&lt;span class="comment"&gt;# Now some random helper methods for decoding&lt;/span&gt;</del></li>
					
				
						<li>481. 	# Now some random helper methods for decoding</li>
					
				
		
				
						<li><del>482. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_ordered?&lt;/span&gt;</del></li>
					
				
						<li><del>483. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;#&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</del></li>
					
				
						<li><del>484. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>483. 	def list_ordered?</li>
					
				
						<li>484. 		@scanner.matched[0,1] == '#'</li>
					
				
						<li>485. 	end</li>
					
				
		
				
						<li><del>486. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_depth&lt;/span&gt;</del></li>
					
				
						<li><del>487. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;].&lt;/span&gt;&lt;span class="ident"&gt;size&lt;/span&gt;</del></li>
					
				
						<li><del>488. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>487. 	def list_depth</li>
					
				
						<li>488. 		@scanner[1].size</li>
					
				
						<li>489. 	end</li>
					
				
		
				
						<li><del>490. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;str&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>491.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;amp;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>492.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&quot;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;quot;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>493.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&lt;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;lt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</del></li>
					
				
						<li><del>494.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;gt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</del></li>
					
				
						<li><del>495.         &lt;span class="ident"&gt;str&lt;/span&gt;</del></li>
					
				
						<li><del>496.     &lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>491. 	def htmlesc( str )</li>
					
				
						<li>492.         str.gsub!( '&', '&amp;' )</li>
					
				
						<li>493.         str.gsub!( '"', '&quot;' )</li>
					
				
						<li>494.         str.gsub!( '&lt;', '&lt;')</li>
					
				
						<li>495.         str.gsub!( '&gt;', '&gt;')</li>
					
				
						<li>496.         str</li>
					
				
						<li>497.     end</li>
					
				
		
				
						<li><del>498. 	&lt;span class="comment"&gt;# Now the low level matching functions&lt;/span&gt;</del></li>
					
				
						<li>499. 	# Now the low level matching functions</li>
					
				
		
				
						<li><del>500. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;object&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li><del>501. 		&lt;span class="attribute"&gt;@html&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="ident"&gt;object&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;to_s&lt;/span&gt;</del></li>
					
				
						<li><del>502. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>501. 	def add_to_html( object )</li>
					
				
						<li>502. 		@html &lt;&lt; object.to_s</li>
					
				
						<li>503. 	end</li>
					
				
		
				
						<li><del>504. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;html&lt;/span&gt;</del></li>
					
				
						<li><del>505. 		&lt;span class="attribute"&gt;@html&lt;/span&gt;</del></li>
					
				
						<li><del>506. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</del></li>
					
				
						<li>505. 	def html</li>
					
				
						<li>506. 		@html</li>
					
				
						<li>507. 	end</li>
					
				
		
				
						<li><del>508. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;reset&lt;/span&gt;</del></li>
					
				
						<li><del>509. 		&lt;span class="attribute"&gt;@html&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="constant"&gt;StringScanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;new&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@text&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</del></li>
					
				
						<li>509. 	def reset</li>
					
				
						<li><del>510. 		&lt;span class="attribute"&gt;@aliases&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt;</del></li>
					
				
						<li>510. 		@html, @scanner = "" , StringScanner.new( @text )</li>
					
				
						<li><del>511. 		&lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</del></li>
					
				
						<li>511. 		@aliases = {}</li>
					
				
						<li><del>512. 	&lt;span class="keyword"&gt;end&lt;/span&gt;	</del></li>
					
				
						<li>512. 		@indent = 0</li>
					
				
						<li><del>513. &lt;span class="keyword"&gt;end&lt;/span&gt;&lt;/pre&gt;</del></li>
					
				
						<li>513. 	end	</li>
					
				
						<li><del>514. &lt;/div&gt;</del></li>
					
				
						<li>514. end</li>
					
				
						<li>515. &lt;/code&gt;</li>
					
				
						<li>516. &lt;/pre&gt;</li>
					
				
					
		</ol>
		<form method=post action='http://tom.counsell.org/rollback/AReWriteOfRedclothTextileToHtmlConvertor' >
			<input name='revision' value='0' type='hidden' />
			<input name='action' value='Undo the changes above' type='submit' />
		</form>
	</div>		

	<div class="undochange">
		<p>Tue Aug 09 04:41:48 -0400 2005 by <a href='../view/Tamc.html'>tamc</a></p>
		<ol>	
		
				
						<li>0. h1. Textile to HTML</li>
					
				
						<li>1. </li>
					
				
						<li>2. Textile is a markup language that is meant to make it quick and easy to write basic web pages for wikis, blogs and other uses.  Redcloth is a ruby class that converts textile to html, written by _why.  Details are at http://www.whytheluckystiff.net/ruby/redcloth/ .  Unfortunately, due to my own failings, I find it hard to understand _why's code, so I wrote a partial reimplementation bellow.  This has the benefit of (for me) being clearer and easier to extend.  The drawback is that it doesn't do all that _why's version does and is slower.  But it is here in case anyone finds it useful.</li>
					
				
						<li>3. </li>
					
				
						<li>4. &lt;div class='ruby'&gt;</li>
					
				
						<li>5. &lt;pre&gt;&lt;span class="ident"&gt;require&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;strscan&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</li>
					
				
						<li>6. </li>
					
				
						<li>7. &lt;span class="comment"&gt;# Note: Does not implement anything beyond that on http://hobix.com/textile/&lt;/span&gt;</li>
					
				
						<li>8. &lt;span class="comment"&gt;# i.e. No markdown, link titles, and converting out of range ASCII&lt;/span&gt;</li>
					
				
						<li>9. &lt;span class="comment"&gt;# AND IT IS MUCH SLOWER THAN REDCLOTH !!&lt;/span&gt;</li>
					
				
						<li>10. &lt;span class="comment"&gt;#&lt;/span&gt;</li>
					
				
						<li>11. &lt;span class="comment"&gt;# Bodged together in a few evenings by Tom Counsell (tamc2@cam.ac.uk)&lt;/span&gt;</li>
					
				
						<li>12. &lt;span class="comment"&gt;# Feel free to do whatever you like with the code.&lt;/span&gt;</li>
					
				
						<li>13. &lt;span class="comment"&gt;#&lt;/span&gt;</li>
					
				
						<li>14. &lt;span class="comment"&gt;# Use is the same as for Redcloth (except that none of the options work):&lt;/span&gt;</li>
					
				
						<li>15. &lt;span class="comment"&gt;# html = TextileParser.new( &quot;textile string&quot;).to_html &lt;/span&gt;</li>
					
				
						<li>16. &lt;span class="comment"&gt;#&lt;/span&gt;</li>
					
				
						<li>17. &lt;span class="keyword"&gt;class &lt;/span&gt;&lt;span class="class"&gt;TextileParser&lt;/span&gt;</li>
					
				
						<li>18. 	</li>
					
				
						<li>19. 	&lt;span class="comment"&gt;# These are applied first&lt;/span&gt;</li>
					
				
						<li>20. 	&lt;span class="constant"&gt;BLOCK_COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</li>
					
				
						<li>21. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;pre.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:pre_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; </li>
					
				
						<li>22. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;code.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:code_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>23. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;notextile.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:notextile_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>24. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;h(&lt;span class="escape"&gt;\d&lt;/span&gt;)(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:heading_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>25. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;bq(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:quote_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>26. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\*&lt;/span&gt;+|&lt;span class="escape"&gt;\#&lt;/span&gt;+)&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt;  &lt;span class="symbol"&gt;:list_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>27. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;table(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:table_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>28. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:unspecified_table_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>29. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\{&lt;/span&gt;.+?&lt;span class="escape"&gt;\}\.\s&lt;/span&gt;+&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:unspecified_table_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# A styled table row		&lt;/span&gt;</li>
					
				
						<li>30. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;p(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:paragraph_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>31. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;fn(&lt;span class="escape"&gt;\d&lt;/span&gt;+)(.*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:footnote_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>32. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\S&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:unspecified_block&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>33. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:skip&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>34. 	&lt;span class="punct"&gt;]&lt;/span&gt;</li>
					
				
						<li>35. 	</li>
					
				
						<li>36. 	&lt;span class="comment"&gt;# Then these&lt;/span&gt;</li>
					
				
						<li>37. 	&lt;span class="constant"&gt;COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</li>
					
				
						<li>38. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;pre.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:pre_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# Can be inline as well as in a block&lt;/span&gt;</li>
					
				
						<li>39. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;code.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:code_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;  &lt;span class="comment"&gt;# Can be inline as well as in a block&lt;/span&gt;</li>
					
				
						<li>40. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;notextile.*?&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:notextile_tag&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;  &lt;span class="comment"&gt;# Can be inline as well as in a block&lt;/span&gt;</li>
					
				
						<li>41. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;@(&lt;span class="escape"&gt;\S&lt;/span&gt;.*?&lt;span class="escape"&gt;\S&lt;/span&gt;)@&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:quick_escape_code&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; </li>
					
				
						<li>42. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&quot;(.+?)&quot;:(&lt;span class="escape"&gt;\S&lt;/span&gt;*&lt;span class="escape"&gt;\w\/&lt;/span&gt;?)&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:textile_link&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>43. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\[&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\]&lt;/span&gt;:(&lt;span class="escape"&gt;\S&lt;/span&gt;*&lt;span class="escape"&gt;\w\/&lt;/span&gt;?)&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:textile_link_alias&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>44. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;!(.+?)!(&lt;span class="escape"&gt;\S&lt;/span&gt;*)&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:image_link&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>45. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;([A-Z0-9]+)&lt;span class="escape"&gt;\(&lt;/span&gt;(.*?)&lt;span class="escape"&gt;\)&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:acronym&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>46. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\S&lt;/span&gt;+?)&lt;span class="escape"&gt;\[&lt;/span&gt;(&lt;span class="escape"&gt;\d&lt;/span&gt;+)&lt;span class="escape"&gt;\]&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="symbol"&gt;:footnote&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt;</li>
					
				
						<li>47. 	&lt;span class="punct"&gt;]&lt;/span&gt;	</li>
					
				
						<li>48. 	</li>
					
				
						<li>49. 	&lt;span class="comment"&gt;# Bit of a bodge, but need a different definition of phrase and whitespace in a table&lt;/span&gt;</li>
					
				
						<li>50. 	&lt;span class="constant"&gt;INLINE_COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;+&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</li>
					
				
						<li>51. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\S&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:phrase&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>52. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:space&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>53. 	&lt;span class="punct"&gt;]&lt;/span&gt;</li>
					
				
						<li>54. 	</li>
					
				
						<li>55. 	&lt;span class="constant"&gt;TABLE_INLINE_COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;COMMANDS&lt;/span&gt; &lt;span class="punct"&gt;+&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</li>
					
				
						<li>56. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;[^&lt;span class="escape"&gt;\s\t\r\n\f\|&lt;/span&gt;]+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:phrase&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>57. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="symbol"&gt;:space&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>58. 	&lt;span class="punct"&gt;]&lt;/span&gt;		</li>
					
				
						<li>59. 	</li>
					
				
						<li>60. 	&lt;span class="comment"&gt;# Then these are applied to phrases from above&lt;/span&gt;</li>
					
				
						<li>61. 	&lt;span class="constant"&gt;PHRASE_MODIFIERS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt; </li>
					
				
						<li>62. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;__&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;i&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>63. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;**&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;b&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>64. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;_&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;em&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>65. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;*&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;strong&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>66. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;??&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;cite&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>67. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;-&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;del&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>68. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;+&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ins&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>69. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;^&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;sup&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>70. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;~&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;sub&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt;</li>
					
				
						<li>71. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;%&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;span&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# How to avoid when people use % as in 3.0% growth?&lt;/span&gt;</li>
					
				
						<li>72. 		&lt;span class="punct"&gt;].&lt;/span&gt;&lt;span class="ident"&gt;collect!&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^&lt;span class="expr"&gt;#{Regexp.escape(regexp)}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="expr"&gt;#{Regexp.escape(regexp)}&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt;</li>
					
				
						<li>73. 			</li>
					
				
						<li>74. 	&lt;span class="comment"&gt;# Character substitutions done last to any words&lt;/span&gt;</li>
					
				
						<li>75. 	&lt;span class="constant"&gt;GLYPHS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;[&lt;/span&gt;</li>
					
				
						<li>76. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^&lt;span class="escape"&gt;\'&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8216;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# single opening&lt;/span&gt;</li>
					
				
						<li>77. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^&quot;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8220;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# double opening&lt;/span&gt;</li>
					
				
						<li>78. 		&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\'&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8217;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# single closing&lt;/span&gt;</li>
					
				
						<li>79.        	&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8221;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# double closing&lt;/span&gt;</li>
					
				
						<li>80.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\.&lt;/span&gt;{3}$&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;\1&amp;#8230;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# ellipsis&lt;/span&gt;</li>
					
				
						<li>81.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;--&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;\1&amp;#8212;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# em dash&lt;/span&gt;</li>
					
				
						<li>82.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;-&gt;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt; &amp;rarr; &lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# right arrow&lt;/span&gt;</li>
					
				
						<li>83.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;-$&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt; &amp;#8211; &lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# en dash&lt;/span&gt;</li>
					
				
						<li>84. </li>
					
				
						<li>85.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;(TM)&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#8482;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# trademark&lt;/span&gt;</li>
					
				
						<li>86.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;(R)&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#174;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="comment"&gt;# registered&lt;/span&gt;</li>
					
				
						<li>87.         &lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;(C)&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;#169;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="comment"&gt;# copyright&lt;/span&gt;</li>
					
				
						<li>88.     &lt;span class="punct"&gt;]&lt;/span&gt;</li>
					
				
						<li>89.     </li>
					
				
						<li>90. 	&lt;span class="comment"&gt;# This is just used to give the ouput html a more beautiful layout&lt;/span&gt;</li>
					
				
						<li>91. 	&lt;span class="comment"&gt;# All tags in here will get a newline after they are output&lt;/span&gt;</li>
					
				
						<li>92. 	&lt;span class="comment"&gt;# and the indent for following lines increased by the number&lt;/span&gt;</li>
					
				
						<li>93. 	&lt;span class="constant"&gt;INDENTING_TAGS&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; 	&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ul&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>94. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ol&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>95. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;li&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>96. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;blockquote&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>97. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;table&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>98. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;tr&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>99. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;td&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>100. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;th&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>101. 						&lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;</li>
					
				
						<li>102. 					 &lt;span class="punct"&gt;}&lt;/span&gt;</li>
					
				
						<li>103. 	</li>
					
				
						<li>104. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;initialize&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;text&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>105. 		&lt;span class="attribute"&gt;@text&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;text&lt;/span&gt;</li>
					
				
						<li>106. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>107. </li>
					
				
						<li>108. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;settings&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;nil&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>109. 		&lt;span class="ident"&gt;reset&lt;/span&gt;</li>
					
				
						<li>110. 		&lt;span class="ident"&gt;convert_text&lt;/span&gt;</li>
					
				
						<li>111. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="ident"&gt;html&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;chomp&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;chomp&lt;/span&gt; &lt;span class="comment"&gt;# the tests don't have any trailing \ns&lt;/span&gt;</li>
					
				
						<li>112. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>113. 	</li>
					
				
						<li>114. 	&lt;span class="ident"&gt;private&lt;/span&gt;</li>
					
				
						<li>115. 	</li>
					
				
						<li>116. 	&lt;span class="comment"&gt;## Methods dealing with blocks of text are called first&lt;/span&gt;</li>
					
				
						<li>117. 	</li>
					
				
						<li>118. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;convert_text&lt;/span&gt;</li>
					
				
						<li>119. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</li>
					
				
						<li>120. 			&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;BLOCK_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>121. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="comment"&gt;# Prettier html if extra space between blocks &lt;/span&gt;</li>
					
				
						<li>122. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>123. 		&lt;span class="ident"&gt;insert_any_link_aliases&lt;/span&gt;</li>
					
				
						<li>124. 		&lt;span class="ident"&gt;html&lt;/span&gt;</li>
					
				
						<li>125. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>126. 	</li>
					
				
						<li>127. 	&lt;span class="comment"&gt;# These are all the block commands&lt;/span&gt;</li>
					
				
						<li>128. 	</li>
					
				
						<li>129. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;paragraph_block&lt;/span&gt;</li>
					
				
						<li>130. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </li>
					
				
						<li>131. 			&lt;span class="ident"&gt;standard_paragraph&lt;/span&gt;</li>
					
				
						<li>132. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>133. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>134. 	</li>
					
				
						<li>135. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;quote_block&lt;/span&gt;</li>
					
				
						<li>136. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;blockquote&lt;/span&gt;&lt;span class="punct"&gt;&quot;,&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>137. 			&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>138. 				&lt;span class="ident"&gt;standard_paragraph&lt;/span&gt;</li>
					
				
						<li>139. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>140. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>141. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>142. 	</li>
					
				
						<li>143. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;unspecified_block&lt;/span&gt;</li>
					
				
						<li>144. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;unscan&lt;/span&gt;</li>
					
				
						<li>145. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>146. 			&lt;span class="ident"&gt;standard_paragraph&lt;/span&gt;</li>
					
				
						<li>147. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>148. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>149. 		</li>
					
				
						<li>150. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;heading_block&lt;/span&gt;</li>
					
				
						<li>151. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;h&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;,&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>152. 			&lt;span class="ident"&gt;standard_line&lt;/span&gt; &lt;span class="comment"&gt;# Assume titles may only be on one line&lt;/span&gt;</li>
					
				
						<li>153. 		&lt;span class="keyword"&gt;end&lt;/span&gt; </li>
					
				
						<li>154. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>155. 	</li>
					
				
						<li>156. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_block&lt;/span&gt;</li>
					
				
						<li>157. 		&lt;span class="ident"&gt;ordered&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;list_ordered?&lt;/span&gt; &lt;span class="comment"&gt;# See what sort of list we have&lt;/span&gt;</li>
					
				
						<li>158. 		&lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;list_depth&lt;/span&gt;</li>
					
				
						<li>159. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;unscan&lt;/span&gt; &lt;span class="comment"&gt;# So that the lines can be scanned individually&lt;/span&gt;</li>
					
				
						<li>160. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ol&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;ul&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>161. 			&lt;span class="ident"&gt;list_line&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_list?&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>162. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>163. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>164. 	</li>
					
				
						<li>165. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;table_block&lt;/span&gt;</li>
					
				
						<li>166. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;table&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>167. 			&lt;span class="ident"&gt;table_line&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;</li>
					
				
						<li>168. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>169. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>170. 	</li>
					
				
						<li>171. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;unspecified_table_block&lt;/span&gt;</li>
					
				
						<li>172. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;unscan&lt;/span&gt;</li>
					
				
						<li>173. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;table&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>174. 			&lt;span class="ident"&gt;table_line&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;</li>
					
				
						<li>175. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>176. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>177. 	</li>
					
				
						<li>178. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;footnote_block&lt;/span&gt;</li>
					
				
						<li>179. 		&lt;span class="ident"&gt;number&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt;</li>
					
				
						<li>180. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>181. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:id&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;fn&lt;span class="expr"&gt;#{number}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>182. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;p&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>183. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;sup&gt;&lt;span class="expr"&gt;#{number}&lt;/span&gt;&lt;/sup&gt; &lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>184. 			&lt;span class="ident"&gt;standard_line&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;</li>
					
				
						<li>185. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>186. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>187. 	</li>
					
				
						<li>188. 	&lt;span class="comment"&gt;# Now descend into methods dealing with lines of text&lt;/span&gt;</li>
					
				
						<li>189. 	</li>
					
				
						<li>190. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;pre_tag&lt;/span&gt;</li>
					
				
						<li>191. 		&lt;span class="ident"&gt;escape_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;pre&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</li>
					
				
						<li>192. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>193. 	</li>
					
				
						<li>194. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;code_tag&lt;/span&gt;</li>
					
				
						<li>195. 		&lt;span class="ident"&gt;escape_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;code&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</li>
					
				
						<li>196. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>197. 	</li>
					
				
						<li>198. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;notextile_tag&lt;/span&gt;</li>
					
				
						<li>199. 		&lt;span class="ident"&gt;escape_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;notextile&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="constant"&gt;false&lt;/span&gt;</li>
					
				
						<li>200. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>201. 	</li>
					
				
						<li>202. 	&lt;span class="comment"&gt;# This escapes until a matching close tag&lt;/span&gt;</li>
					
				
						<li>203. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;escape_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;include_tag_in_output&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>204. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;include_tag_in_output&lt;/span&gt;</li>
					
				
						<li>205. 		&lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt;</li>
					
				
						<li>206. 		&lt;span class="keyword"&gt;while&lt;/span&gt; &lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;&gt;&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</li>
					
				
						<li>207. 			&lt;span class="keyword"&gt;break&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(.*?)(&lt;(&lt;span class="escape"&gt;\/&lt;/span&gt;)?&lt;span class="expr"&gt;#{tag}&lt;/span&gt;.*?&gt;)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="ident"&gt;m&lt;/span&gt;&lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="comment"&gt;# Breaks if no closing tag&lt;/span&gt;</li>
					
				
						<li>208. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;||&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>209. 			&lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;+&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;3&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="punct"&gt;-&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="number"&gt;1&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>210. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;level&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</li>
					
				
						<li>211. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>212. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;include_tag_in_output&lt;/span&gt;</li>
					
				
						<li>213. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>214. 	</li>
					
				
						<li>215. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;quick_escape_code&lt;/span&gt;</li>
					
				
						<li>216. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;code&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </li>
					
				
						<li>217. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>218. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>219. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>220. 	</li>
					
				
						<li>221. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_line&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>222. 		&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;li&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>223. 			&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(#+|&lt;span class="escape"&gt;\*&lt;/span&gt;+)&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>224. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;list_ordered?&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="ident"&gt;ordered&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;&amp;&amp;&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;list_depth&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>225. 				&lt;span class="ident"&gt;standard_line&lt;/span&gt;</li>
					
				
						<li>226. 			&lt;span class="keyword"&gt;else&lt;/span&gt; &lt;span class="comment"&gt;# Recursive for sub lists&lt;/span&gt;</li>
					
				
						<li>227. 				&lt;span class="ident"&gt;list_block&lt;/span&gt;</li>
					
				
						<li>228. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>229. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>230. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>231. 		</li>
					
				
						<li>232. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;table_line&lt;/span&gt;</li>
					
				
						<li>233. 		&lt;span class="comment"&gt;# Are their row attributes at that start of the line?&lt;/span&gt;</li>
					
				
						<li>234. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\{&lt;/span&gt;.+?&lt;span class="escape"&gt;\}&lt;/span&gt;)&lt;span class="escape"&gt;\.\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;])&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt; 	</li>
					
				
						<li>235. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="comment"&gt;# Get rid of any leading cell opening&lt;/span&gt;</li>
					
				
						<li>236. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;tr&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </li>
					
				
						<li>237. 			&lt;span class="ident"&gt;table_cell&lt;/span&gt; &lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_table_line?&lt;/span&gt;</li>
					
				
						<li>238. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>239. 	&lt;span class="keyword"&gt;end&lt;/span&gt;	</li>
					
				
						<li>240. 	</li>
					
				
						<li>241. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;standard_paragraph&lt;/span&gt;</li>
					
				
						<li>242. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_paragraph?&lt;/span&gt;	</li>
					
				
						<li>243. 			&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;INLINE_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>244. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>245. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>246. 	</li>
					
				
						<li>247. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;standard_line&lt;/span&gt;</li>
					
				
						<li>248. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_line?&lt;/span&gt;</li>
					
				
						<li>249. 			&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;INLINE_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>250. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>251. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>252. 	</li>
					
				
						<li>253. 	&lt;span class="comment"&gt;# Now descend into methods dealing with phrases&lt;/span&gt;</li>
					
				
						<li>254. 	</li>
					
				
						<li>255. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;table_cell&lt;/span&gt;</li>
					
				
						<li>256. 		&lt;span class="comment"&gt;# Style defined at start of cell ?&lt;/span&gt;</li>
					
				
						<li>257. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(_)?(&lt;span class="escape"&gt;\S&lt;/span&gt;*?)&lt;span class="escape"&gt;\.\s&lt;/span&gt;*&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt;  &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;])&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt;</li>
					
				
						<li>258. 		&lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;?&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;th&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;:&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;td&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; </li>
					
				
						<li>259. 			&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;end_of_table_cell?&lt;/span&gt;</li>
					
				
						<li>260. 				&lt;span class="ident"&gt;send&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="constant"&gt;TABLE_INLINE_COMMANDS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;detect&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;method&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;}[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>261. 			&lt;span class="keyword"&gt;end&lt;/span&gt;	</li>
					
				
						<li>262. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>263. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>264. 	</li>
					
				
						<li>265. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;footnote&lt;/span&gt;</li>
					
				
						<li>266. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;sup&gt;&lt;a href=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;#fn&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&gt;&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;/a&gt;&lt;/sup&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>267. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>268. 	</li>
					
				
						<li>269. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;acronym&lt;/span&gt;</li>
					
				
						<li>270. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;acronym title=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&gt;&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;/acronym&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>271. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>272. 	</li>
					
				
						<li>273. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;phrase&lt;/span&gt;</li>
					
				
						<li>274. 		&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt;</li>
					
				
						<li>275. 		</li>
					
				
						<li>276. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;parse_glyphs&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\w&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt; &lt;span class="comment"&gt;# If a word is entirely symbols then we will leave it in peace.&lt;/span&gt;</li>
					
				
						<li>277. 		</li>
					
				
						<li>278. 		&lt;span class="comment"&gt;# Open tags&lt;/span&gt;</li>
					
				
						<li>279. 		&lt;span class="constant"&gt;PHRASE_MODIFIERS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;start_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;end_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</li>
					
				
						<li>280. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="ident"&gt;start_r&lt;/span&gt;</li>
					
				
						<li>281. 				&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$'&lt;/span&gt; &lt;span class="comment"&gt;# The bit after the match&lt;/span&gt;</li>
					
				
						<li>282. 				&lt;span class="comment"&gt;# Look for matching brackets that indicate there are attributes&lt;/span&gt;</li>
					
				
						<li>283. 				&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\(&lt;/span&gt;.+?&lt;span class="escape"&gt;\)&lt;/span&gt;|&lt;span class="escape"&gt;\{&lt;/span&gt;.+?&lt;span class="escape"&gt;\}&lt;/span&gt;|&lt;span class="escape"&gt;\[&lt;/span&gt;.+?&lt;span class="escape"&gt;\]&lt;/span&gt;)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt; 				</li>
					
				
						<li>284. 					&lt;span class="ident"&gt;open_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>285. 					&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$'&lt;/span&gt;</li>
					
				
						<li>286. 				&lt;span class="keyword"&gt;else&lt;/span&gt;</li>
					
				
						<li>287. 					&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</li>
					
				
						<li>288. 				&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>289. 				&lt;span class="keyword"&gt;break&lt;/span&gt;</li>
					
				
						<li>290. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>291. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>292. 		</li>
					
				
						<li>293. 		&lt;span class="comment"&gt;# Close tags&lt;/span&gt;</li>
					
				
						<li>294. 		&lt;span class="ident"&gt;end_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;nil&lt;/span&gt;</li>
					
				
						<li>295. 		&lt;span class="constant"&gt;PHRASE_MODIFIERS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;start_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;end_r&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</li>
					
				
						<li>296. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="ident"&gt;end_r&lt;/span&gt;</li>
					
				
						<li>297. 				&lt;span class="ident"&gt;end_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</li>
					
				
						<li>298. 				&lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$`&lt;/span&gt; &lt;span class="comment"&gt;# The bit before the match&lt;/span&gt;</li>
					
				
						<li>299. 				&lt;span class="keyword"&gt;break&lt;/span&gt;</li>
					
				
						<li>300. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>301. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>302. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="ident"&gt;parse_glyphs&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>303. 		&lt;span class="ident"&gt;close_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;end_tag&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;end_tag&lt;/span&gt;</li>
					
				
						<li>304. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>305. 	</li>
					
				
						<li>306. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;space&lt;/span&gt;</li>
					
				
						<li>307. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt;</li>
					
				
						<li>308. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>309. 		</li>
					
				
						<li>310. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;image_link&lt;/span&gt;</li>
					
				
						<li>311. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^!([&lt;&gt;]*)(.*?)(!|&lt;span class="escape"&gt;\(&lt;/span&gt;(.*?)&lt;span class="escape"&gt;\)&lt;/span&gt;!)($|(:(.+?)$))&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>312. 		&lt;span class="ident"&gt;alignment&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;src&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;title&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;url&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$2&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$4&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$7&lt;/span&gt;</li>
					
				
						<li>313. 		&lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt;</li>
					
				
						<li>314. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;float:right&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;alignment&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</li>
					
				
						<li>315. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;float:left&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;alignment&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&lt;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</li>
					
				
						<li>316. </li>
					
				
						<li>317. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:src&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;src&lt;/span&gt;</li>
					
				
						<li>318. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:alt&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="symbol"&gt;:title&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;title&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;title&lt;/span&gt;</li>
					
				
						<li>319. 		&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;url&lt;/span&gt;</li>
					
				
						<li>320. 			&lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="symbol"&gt;:href&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="ident"&gt;url&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt;</li>
					
				
						<li>321. 				&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;img&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt;</li>
					
				
						<li>322. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>323. 		&lt;span class="keyword"&gt;else&lt;/span&gt;</li>
					
				
						<li>324. 			&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;img&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt;</li>
					
				
						<li>325. 		&lt;span class="keyword"&gt;end&lt;/span&gt;	</li>
					
				
						<li>326. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>327. 	</li>
					
				
						<li>328. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;skip&lt;/span&gt;</li>
					
				
						<li>329. 		&lt;span class="comment"&gt;# Do nothing !&lt;/span&gt;</li>
					
				
						<li>330. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>331. 	</li>
					
				
						<li>332. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;textile_link&lt;/span&gt;</li>
					
				
						<li>333. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;a href=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{@scanner[2]}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&gt;&lt;span class="expr"&gt;#{@scanner[1]}&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>334. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>335. 	</li>
					
				
						<li>336. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;textile_link_alias&lt;/span&gt;</li>
					
				
						<li>337. 		&lt;span class="comment"&gt;# These are saved for later resubstitution&lt;/span&gt;</li>
					
				
						<li>338. 		&lt;span class="attribute"&gt;@aliases&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;2&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt;</li>
					
				
						<li>339. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>340. 	</li>
					
				
						<li>341. 	&lt;span class="comment"&gt;# These feels clunky, and is done last&lt;/span&gt;</li>
					
				
						<li>342. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;insert_any_link_aliases&lt;/span&gt;</li>
					
				
						<li>343. 		&lt;span class="attribute"&gt;@aliases&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;als&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;href&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</li>
					
				
						<li>344. 			&lt;span class="ident"&gt;html&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;href=&quot;&lt;span class="expr"&gt;#{als}&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class="punct"&gt;/,&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;href=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{href}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>345. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>346. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>347. 	</li>
					
				
						<li>348. 	&lt;span class="comment"&gt;# These are helper methods that make sure html is properly closed and indented&lt;/span&gt;</li>
					
				
						<li>349. 	</li>
					
				
						<li>350. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>351. 		&lt;span class="ident"&gt;open_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>352. 		&lt;span class="keyword"&gt;yield&lt;/span&gt;</li>
					
				
						<li>353. 		&lt;span class="ident"&gt;close_tag&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</li>
					
				
						<li>354. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>355. 	</li>
					
				
						<li>356. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;close_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="symbol"&gt;:all_tags&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>357. 		&lt;span class="comment"&gt;# Check the tag has been opened&lt;/span&gt;</li>
					
				
						<li>358. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;open_tags&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;include?&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; &lt;span class="punct"&gt;||&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="symbol"&gt;:all_tags&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>359. 		</li>
					
				
						<li>360. 		&lt;span class="comment"&gt;# Close all tags up to that tag (in case one was not closed)&lt;/span&gt;</li>
					
				
						<li>361. 		&lt;span class="keyword"&gt;until&lt;/span&gt; &lt;span class="ident"&gt;open_tags&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;empty?&lt;/span&gt;</li>
					
				
						<li>362. 			&lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="ident"&gt;open_tags&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;pop&lt;/span&gt;</li>
					
				
						<li>363. 			&lt;span class="comment"&gt;# This is just stuff to make the html look pretty&lt;/span&gt;</li>
					
				
						<li>364. 			&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;INDENTING_TAGS&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt; </li>
					
				
						<li>365. 				&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</li>
					
				
						<li>366. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{open_tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>367. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>368. 				&lt;span class="keyword"&gt;else&lt;/span&gt;</li>
					
				
						<li>369. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;html&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;$&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>370. 					&lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;-=&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt;</li>
					
				
						<li>371. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\t&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;*&lt;/span&gt; &lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>372. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{open_tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>373. 					&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>374. 				&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>375. 			&lt;span class="keyword"&gt;else&lt;/span&gt;</li>
					
				
						<li>376. 				&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/&lt;span class="expr"&gt;#{open_tag}&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>377. 			&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>378. 			&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;open_tag&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</li>
					
				
						<li>379. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>380. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>381. 	</li>
					
				
						<li>382. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;open_tag&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;attributes&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{},&lt;/span&gt; &lt;span class="ident"&gt;no_close_tag&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;false&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>383. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\t&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;*&lt;/span&gt; &lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>384. 		</li>
					
				
						<li>385. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;&lt;span class="expr"&gt;#{tag}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>386. 		</li>
					
				
						<li>387. 		&lt;span class="ident"&gt;attributes&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;key&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;value&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; 	&lt;span class="ident"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt; &lt;span class="expr"&gt;#{key.to_s}&lt;/span&gt;=&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;span class="expr"&gt;#{value.to_s}&lt;/span&gt;&lt;span class="escape"&gt;\&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;	&lt;span class="punct"&gt;}&lt;/span&gt;</li>
					
				
						<li>388. 		</li>
					
				
						<li>389. 		&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;no_close_tag&lt;/span&gt;</li>
					
				
						<li>390. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt; /&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>391. 			&lt;span class="keyword"&gt;return&lt;/span&gt;</li>
					
				
						<li>392. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>393. 		</li>
					
				
						<li>394. 		&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>395. 		</li>
					
				
						<li>396. 		&lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="constant"&gt;INDENTING_TAGS&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt; &lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;			</li>
					
				
						<li>397. 			&lt;span class="ident"&gt;add_to_html&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</li>
					
				
						<li>398. 			&lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;+=&lt;/span&gt; &lt;span class="ident"&gt;indent&lt;/span&gt;</li>
					
				
						<li>399. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>400. 		&lt;span class="ident"&gt;open_tags&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="ident"&gt;tag&lt;/span&gt;</li>
					
				
						<li>401. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>402. 	</li>
					
				
						<li>403. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;open_tags&lt;/span&gt;</li>
					
				
						<li>404. 		&lt;span class="attribute"&gt;@open_tags&lt;/span&gt; &lt;span class="punct"&gt;||=&lt;/span&gt; &lt;span class="punct"&gt;[]&lt;/span&gt;</li>
					
				
						<li>405. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>406. 	</li>
					
				
						<li>407. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;parse_attributes&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>408. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;&amp;&amp;&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;!=&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt;</li>
					
				
						<li>409. 		&lt;span class="ident"&gt;a&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="symbol"&gt;:style&lt;/span&gt; &lt;span class="punct"&gt;=&gt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt;</li>
					
				
						<li>410. 		</li>
					
				
						<li>411. 		&lt;span class="comment"&gt;# The hand-entered classes, ids, styles and langs&lt;/span&gt;</li>
					
				
						<li>412. 		&lt;span class="comment"&gt;# These are replaced with &quot;&quot; so their content cannot be matched below&lt;/span&gt;</li>
					
				
						<li>413. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:lang&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\[&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\]&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>414. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:class&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;sub!&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\(&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\)&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,'&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</li>
					
				
						<li>415. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:class&lt;/span&gt;&lt;span class="punct"&gt;],&lt;/span&gt; &lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:id&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="global"&gt;$2&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:class&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt;  &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;^(.*?)#(.*)$&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>416. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;span class="expr"&gt;#{$1}&lt;/span&gt;;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;sub!&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\{&lt;/span&gt;(.+?)&lt;span class="escape"&gt;\}&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/,'&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</li>
					
				
						<li>417. </li>
					
				
						<li>418. 		&lt;span class="comment"&gt;# Various padding and indents&lt;/span&gt;</li>
					
				
						<li>419. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;padding-left:&lt;span class="expr"&gt;#{ $1.length }&lt;/span&gt;em;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\(&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>420. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;padding-right:&lt;span class="expr"&gt;#{ $1.length }&lt;/span&gt;em;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(&lt;span class="escape"&gt;\)&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;		</li>
					
				
						<li>421. </li>
					
				
						<li>422. 		&lt;span class="comment"&gt;# The various alignments&lt;/span&gt;</li>
					
				
						<li>423. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:left;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;(?!&gt;)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>424. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:right;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;(?!&lt;)&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>425. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:justify;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>426. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;text-align:center;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;=&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>427. 		</li>
					
				
						<li>428. 		&lt;span class="comment"&gt;#Various column spans on tables&lt;/span&gt;</li>
					
				
						<li>429. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:colspan&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\\&lt;/span&gt;(&lt;span class="escape"&gt;\d&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>430. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:rowspan&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="global"&gt;$1&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\/&lt;/span&gt;(&lt;span class="escape"&gt;\d&lt;/span&gt;+)&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>431. 		</li>
					
				
						<li>432. 		&lt;span class="comment"&gt;#Vertical alignments on tables&lt;/span&gt;</li>
					
				
						<li>433. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;vertical-align:top;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\^&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>434. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="symbol"&gt;:style&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;vertical-align:bottom;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;attribute_text&lt;/span&gt; &lt;span class="punct"&gt;=~&lt;/span&gt; &lt;span class="punct"&gt;/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\~&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/&lt;/span&gt;</li>
					
				
						<li>435. 		</li>
					
				
						<li>436. 		&lt;span class="comment"&gt;# Get rid of any empty attributes before returning&lt;/span&gt;</li>
					
				
						<li>437. 		&lt;span class="ident"&gt;a&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;delete_if&lt;/span&gt; &lt;span class="punct"&gt;{&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;k&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="ident"&gt;v&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt; &lt;span class="punct"&gt;!&lt;/span&gt;&lt;span class="ident"&gt;v&lt;/span&gt; &lt;span class="punct"&gt;||&lt;/span&gt; &lt;span class="punct"&gt;(&lt;/span&gt;&lt;span class="ident"&gt;v&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;)&lt;/span&gt; &lt;span class="punct"&gt;}&lt;/span&gt;</li>
					
				
						<li>438. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>439. 	</li>
					
				
						<li>440. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;parse_glyphs&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;word&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>441. 		&lt;span class="constant"&gt;GLYPHS&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;each&lt;/span&gt; &lt;span class="keyword"&gt;do&lt;/span&gt; &lt;span class="punct"&gt;|&lt;/span&gt;&lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="ident"&gt;replacement&lt;/span&gt;&lt;span class="punct"&gt;|&lt;/span&gt;</li>
					
				
						<li>442. 			&lt;span class="ident"&gt;word&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;regexp&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="ident"&gt;replacement&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>443. 		&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>444. 		&lt;span class="ident"&gt;word&lt;/span&gt;</li>
					
				
						<li>445. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>446. 	</li>
					
				
						<li>447. 	&lt;span class="comment"&gt;# Now some helper methods for spotting the ends of sections&lt;/span&gt;</li>
					
				
						<li>448. 	</li>
					
				
						<li>449. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_paragraph?&lt;/span&gt;</li>
					
				
						<li>450. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</li>
					
				
						<li>451. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>452. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>453. 	</li>
					
				
						<li>454. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_list?&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>455. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</li>
					
				
						<li>456. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;unless&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;(#+|&lt;span class="escape"&gt;\*&lt;/span&gt;+)&lt;span class="escape"&gt;\s&lt;/span&gt;+&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt; &lt;span class="comment"&gt;# Not a list any more&lt;/span&gt;</li>
					
				
						<li>457. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="ident"&gt;list_depth&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;/span&gt; &lt;span class="ident"&gt;depth&lt;/span&gt; &lt;span class="comment"&gt;# End of this sub list&lt;/span&gt;</li>
					
				
						<li>458. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>459. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>460. 	</li>
					
				
						<li>461. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_line?&lt;/span&gt;</li>
					
				
						<li>462. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</li>
					
				
						<li>463. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>464. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>465. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>466. 	</li>
					
				
						<li>467. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_table_line?&lt;/span&gt;</li>
					
				
						<li>468. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</li>
					
				
						<li>469. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;{2,}&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>470. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|\s&lt;/span&gt;*&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>471. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>472. 	</li>
					
				
						<li>473. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;end_of_table_cell?&lt;/span&gt;</li>
					
				
						<li>474. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;eos?&lt;/span&gt;</li>
					
				
						<li>475. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>476. 		&lt;span class="keyword"&gt;return&lt;/span&gt; &lt;span class="constant"&gt;true&lt;/span&gt; &lt;span class="keyword"&gt;if&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;check&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|\s&lt;/span&gt;*&lt;span class="escape"&gt;\n&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>477. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;scan&lt;/span&gt;&lt;span class="punct"&gt;(/&lt;/span&gt;&lt;span class="regex"&gt;&lt;span class="escape"&gt;\|&lt;/span&gt;&lt;/span&gt;&lt;span class="punct"&gt;/)&lt;/span&gt;</li>
					
				
						<li>478. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>479. 	</li>
					
				
						<li>480. 	&lt;span class="comment"&gt;# Now some random helper methods for decoding&lt;/span&gt;</li>
					
				
						<li>481. 	</li>
					
				
						<li>482. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_ordered?&lt;/span&gt;</li>
					
				
						<li>483. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;matched&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;0&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;]&lt;/span&gt; &lt;span class="punct"&gt;==&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;#&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt;</li>
					
				
						<li>484. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>485. 	</li>
					
				
						<li>486. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;list_depth&lt;/span&gt;</li>
					
				
						<li>487. 		&lt;span class="attribute"&gt;@scanner&lt;/span&gt;&lt;span class="punct"&gt;[&lt;/span&gt;&lt;span class="number"&gt;1&lt;/span&gt;&lt;span class="punct"&gt;].&lt;/span&gt;&lt;span class="ident"&gt;size&lt;/span&gt;</li>
					
				
						<li>488. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>489. 	</li>
					
				
						<li>490. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;htmlesc&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;str&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>491.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;amp;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>492.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&quot;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;quot;&lt;/span&gt;&lt;span class="punct"&gt;'&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>493.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&lt;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;lt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</li>
					
				
						<li>494.         &lt;span class="ident"&gt;str&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;gsub!&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&gt;&lt;/span&gt;&lt;span class="punct"&gt;',&lt;/span&gt; &lt;span class="punct"&gt;'&lt;/span&gt;&lt;span class="string"&gt;&amp;gt;&lt;/span&gt;&lt;span class="punct"&gt;')&lt;/span&gt;</li>
					
				
						<li>495.         &lt;span class="ident"&gt;str&lt;/span&gt;</li>
					
				
						<li>496.     &lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>497. 	</li>
					
				
						<li>498. 	&lt;span class="comment"&gt;# Now the low level matching functions&lt;/span&gt;</li>
					
				
						<li>499. 	</li>
					
				
						<li>500. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;add_to_html&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="ident"&gt;object&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>501. 		&lt;span class="attribute"&gt;@html&lt;/span&gt; &lt;span class="punct"&gt;&lt;&lt;&lt;/span&gt; &lt;span class="ident"&gt;object&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;to_s&lt;/span&gt;</li>
					
				
						<li>502. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>503. 	</li>
					
				
						<li>504. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;html&lt;/span&gt;</li>
					
				
						<li>505. 		&lt;span class="attribute"&gt;@html&lt;/span&gt;</li>
					
				
						<li>506. 	&lt;span class="keyword"&gt;end&lt;/span&gt;</li>
					
				
						<li>507. 	</li>
					
				
						<li>508. 	&lt;span class="keyword"&gt;def &lt;/span&gt;&lt;span class="method"&gt;reset&lt;/span&gt;</li>
					
				
						<li>509. 		&lt;span class="attribute"&gt;@html&lt;/span&gt;&lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="attribute"&gt;@scanner&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;&quot;&lt;/span&gt;&lt;span class="string"&gt;&lt;/span&gt;&lt;span class="punct"&gt;&quot;&lt;/span&gt; &lt;span class="punct"&gt;,&lt;/span&gt; &lt;span class="constant"&gt;StringScanner&lt;/span&gt;&lt;span class="punct"&gt;.&lt;/span&gt;&lt;span class="ident"&gt;new&lt;/span&gt;&lt;span class="punct"&gt;(&lt;/span&gt; &lt;span class="attribute"&gt;@text&lt;/span&gt; &lt;span class="punct"&gt;)&lt;/span&gt;</li>
					
				
						<li>510. 		&lt;span class="attribute"&gt;@aliases&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="punct"&gt;{}&lt;/span&gt;</li>
					
				
						<li>511. 		&lt;span class="attribute"&gt;@indent&lt;/span&gt; &lt;span class="punct"&gt;=&lt;/span&gt; &lt;span class="number"&gt;0&lt;/span&gt;</li>
					
				
						<li>512. 	&lt;span class="keyword"&gt;end&lt;/span&gt;	</li>
					
				
						<li>513. &lt;span class="keyword"&gt;end&lt;/span&gt;&lt;/pre&gt;</li>
					
				
						<li>514. &lt;/div&gt;</li>
					
				
					
		</ol>
		<form method=post action='http://tom.counsell.org/rollback/AReWriteOfRedclothTextileToHtmlConvertor' >
			<input name='revision' value='-1' type='hidden' />
			<input name='action' value='Undo the changes above' type='submit' />
		</form>
	</div>		



<div class='command'>
	<a href='http://tom.counsell.org/edit/AReWriteOfRedclothTextileToHtmlConvertor' accesskey="R" >Return to editing</a>
</div>

			<br />
		</div>
		<br />
	</div>
</div>



<div id="footer">

 <br />From an original theme on <a class="footerLink" href='http://wordpress.org' title='Proudly powered by WordPress, state-of-the-art semantic personal publishing platform'>WordPress 1.5</a>. <br />

This theme started out as <a class="footerLink" href="http://www.thoughtmechanics.com/blog/templates">Benevolence</a><br /> and ended up as  <a class="footerLink" href="http://theloo.org/2005/03/06/borderline-chaos/">Borderline Chaos (1.9)</a>.  <br />It validates in <a class="footerLink" href="http://validator.w3.org/check/referer">XHTML</a> and <a class="footerLink" href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> minus plugins.
<br />

<a class="footerLink" href="http://www.managedtasks.com/wpthemes/blog">WordPress 1.5 Themes</a> is &copy; the Author. 


<br /><br />

</div>



</div>


</div>
</body>

</html>
